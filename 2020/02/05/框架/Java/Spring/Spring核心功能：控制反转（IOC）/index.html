<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Spring 核心功能：控制反转（IOC） - 路由器</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="路由器"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="路由器"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="控制反转（IOC）也被称为依赖注入（DI）。这是一个由对象通过构造函数的参数、工厂方法的参数或者配置来定义依赖性，然后会在创建 bean 时注入这些依赖项的过程。而原本的 bean 如果想要获取依赖项，需要通过构造函数或者单例模式、构造器模式等方式获取依赖项的实例，所以可以发现Spring的依赖注入其实是原本bean 获取以来的逆过程，所以得名：控制反转。"><meta property="og:type" content="blog"><meta property="og:title" content="Spring 核心功能：控制反转（IOC）"><meta property="og:url" content="http://example.com/2020/02/05/%E6%A1%86%E6%9E%B6/Java/Spring/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/"><meta property="og:site_name" content="路由器"><meta property="og:description" content="控制反转（IOC）也被称为依赖注入（DI）。这是一个由对象通过构造函数的参数、工厂方法的参数或者配置来定义依赖性，然后会在创建 bean 时注入这些依赖项的过程。而原本的 bean 如果想要获取依赖项，需要通过构造函数或者单例模式、构造器模式等方式获取依赖项的实例，所以可以发现Spring的依赖注入其实是原本bean 获取以来的逆过程，所以得名：控制反转。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/images/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/image-20220425230354337.png"><meta property="article:published_time" content="2020-02-05T04:36:11.000Z"><meta property="article:modified_time" content="2022-06-27T07:35:56.000Z"><meta property="article:author" content="路由器"><meta property="article:tag" content="Spring核心功能"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/../../../../images/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/image-20220425230354337.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2020/02/05/%E6%A1%86%E6%9E%B6/Java/Spring/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/"},"headline":"Spring 核心功能：控制反转（IOC）","image":["http://example.com/images/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/image-20220425230354337.png"],"datePublished":"2020-02-05T04:36:11.000Z","dateModified":"2022-06-27T07:35:56.000Z","author":{"@type":"Person","name":"路由器"},"publisher":{"@type":"Organization","name":"路由器","logo":{"@type":"ImageObject","url":"http://example.com/img/avatar.png"}},"description":"控制反转（IOC）也被称为依赖注入（DI）。这是一个由对象通过构造函数的参数、工厂方法的参数或者配置来定义依赖性，然后会在创建 bean 时注入这些依赖项的过程。而原本的 bean 如果想要获取依赖项，需要通过构造函数或者单例模式、构造器模式等方式获取依赖项的实例，所以可以发现Spring的依赖注入其实是原本bean 获取以来的逆过程，所以得名：控制反转。"}</script><link rel="canonical" href="http://example.com/2020/02/05/%E6%A1%86%E6%9E%B6/Java/Spring/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar.png" alt="路由器" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-05T04:36:11.000Z" title="2020/2/5 12:36:11">2020-02-05</time>发表</span><span class="level-item"><time dateTime="2022-06-27T07:35:56.000Z" title="2022/6/27 15:35:56">2022-06-27</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/Spring/">Spring</a></span><span class="level-item">2 小时读完 (大约15896个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Spring 核心功能：控制反转（IOC）</h1><div class="content"><p>控制反转（<code>IOC</code>）也被称为依赖注入（<code>DI</code>）。这是一个由对象通过构造函数的参数、工厂方法的参数或者配置来定义依赖性，然后会在创建 <code>bean</code> 时注入这些依赖项的过程。而原本的 <code>bean</code> 如果想要获取依赖项，需要通过构造函数或者单例模式、构造器模式等方式获取依赖项的实例，所以可以发现<code>Spring</code>的依赖注入其实是原本<code>bean</code> 获取以来的逆过程，所以得名：控制反转。</p>
<span id="more"></span>

<h2 id="BeanDefinition"><a href="#BeanDefinition" class="headerlink" title="BeanDefinition"></a>BeanDefinition</h2><p>在<code>Spring</code>中，构成应用程序主干并由<code>Spring IOC</code>管理的对象称为<code>bean</code>，它由<code>IOC</code>容器实例化、组装和管理。可以通过配置元数据对<code>bean</code>之间的依赖关系进行配置。<code>bean</code>以<code>beanDefinition</code>形式存在于<code>IOC</code>容器中。</p>
<p><code>BeanDefinition</code> 是一个接口，包含了很多配置信息</p>
<ul>
<li><code>bean</code> 的实际限定类名</li>
<li><code>bean</code> 行为配置元素，说明 <code>bean</code> 在容器中的行为方式（范围、声明周期回调等）</li>
<li>对其他依赖的 <code>bean</code> 的引用</li>
<li>在新创建的对象中设置的其他配置设置——例如，池的大小限制或在管理连接池的 bean 中使用的连接数</li>
</ul>
<h3 id="bean-属性"><a href="#bean-属性" class="headerlink" title="bean 属性"></a>bean 属性</h3><p><code>AbstractBeanDefinition</code>是<code>beanDefinition</code>的子类，其中定义了一组属性：</p>
<ul>
<li><code>scope</code>：bean的作用范围</li>
<li><code>lazyInit</code>：是否延迟加载，<strong>对应bean的lazy-init</strong></li>
<li><code>autowireMode</code>：自动注入模式<ul>
<li><code>AUTOWIRE_NO</code> &#x3D; 0;</li>
<li><code>AUTOWIRE_BY_NAME</code> &#x3D; 1;</li>
<li><code>AUTOWIRE_BY_TYPE</code> &#x3D; 2;</li>
<li><code>AUTOWIRE_CONSTRUCTOR</code> &#x3D; 3;</li>
</ul>
</li>
<li><code>dependencyCheck</code>：依赖检查</li>
<li><code>dependsOn</code>：依赖项数组，<strong>对应bean属性depend-on</strong></li>
<li><code>autowireCandidate</code>：装配该bean时是否对把其他<code>bean</code>注入进来</li>
<li><code>primary</code>：有多个备案候选项时作为首选者，<strong>对应bean属性primary</strong></li>
<li><code>lenientConstructorResolution</code>：是否一个宽松的模式解析构造函数</li>
<li><code>nonPublicAccessAllowed</code>：允许访问非公开的构造器和方法，程序设置</li>
<li><code>qualifiers</code>：用于记录<code>Qualifier</code>，<strong>对应子元素qualifier</strong></li>
<li><code>constructorArgumentValues</code>：构造函数注入属性，<strong>对应bean属性constructor-arg</strong></li>
<li><code>propertyValues</code>：普通属性集合</li>
<li><code>factoryBeanName</code>：<strong>对应bean属性factory-bean</strong></li>
<li><code>factoryMethodName</code>：<strong>对应bean属性factory-method</strong></li>
<li><code>initMethodName</code>：<strong>对应bean属性init-method</strong></li>
<li><code>destroyMethodName</code>：<strong>对应bean属性destroy-method</strong></li>
<li><code>synthetic</code>：创建AOP或不是用户定义时为<code>true</code></li>
<li><code>role</code>：bean的角色<ul>
<li><code>ROLE_APPLICATION</code> &#x3D; 0 :用户</li>
<li><code>ROLE_SUPPORT</code> &#x3D; 1：某些复杂配置一部分</li>
<li><code>ROLE_INFRASTRUCTURE</code> &#x3D; 2：完全内部使用，与用户无</li>
</ul>
</li>
<li><code>description</code>：<code>bean</code>描述</li>
<li><code>resource</code>：<code>bean</code>定义的资源</li>
</ul>
<h3 id="bean-实例化"><a href="#bean-实例化" class="headerlink" title="bean 实例化"></a>bean 实例化</h3><p><code>BeanDefinition</code>本质上时创建一个或多个对象的方法。在<code>bean</code>被访问时，容器会查看该bean，如果当前容器中没有，则会使用<code>BeanDefinition</code>创建对应的<code>bean</code>对象并加入到容器中</p>
<h4 id="嵌套类名"><a href="#嵌套类名" class="headerlink" title="嵌套类名"></a>嵌套类名</h4><p>如果在<code>OutClass</code>在<code>com.example</code>包中，并且<code>OutClass</code>类中有一个静态内部类 <code>InnerClass</code>，则他们之间可以使用美元符号（$）或点（.）分隔，比如 <code>com.example.SomeThing$InnerClass</code>或<code>com.example.SomeThing.InnerClass</code>。</p>
<h4 id="构造函数实例化"><a href="#构造函数实例化" class="headerlink" title="构造函数实例化"></a>构造函数实例化</h4><p><a href="#%E5%9F%BA%E4%BA%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">点击查看示例</a></p>
<h4 id="静态工厂方法实例化"><a href="#静态工厂方法实例化" class="headerlink" title="静态工厂方法实例化"></a>静态工厂方法实例化</h4><p>定义使用静态工厂方法创建的 bean 时，使用<code>class</code> 属性指定包含<code>static</code>工厂方法的类和命名属性以<code>factory-method</code>指定工厂方法本身的名称</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">      &lt;!<span class="attr">--</span>工厂类 <span class="attr">--</span>&gt;</span></span><br><span class="line">      class=&quot;examples.ClientService&quot;</span><br><span class="line">	  <span class="comment">&lt;!--工厂类中创建bean的静态方法 --&gt;</span></span><br><span class="line">      factory-method=&quot;createInstance&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="实例工厂方法初始化"><a href="#实例工厂方法初始化" class="headerlink" title="实例工厂方法初始化"></a>实例工厂方法初始化</h4><p>实力工厂方法从容器中调用现有的<code>bean</code>的非静态方法创建<code>bean</code>。使用此方式需要将**<code>class</code>属性留空**，使用<code>factory-bean</code>属性中指定当前（或父或祖先）容器中 bean 的名称，使用<code>factory-method</code>属性设置工厂方法本身的名称</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 工厂的bean，其中包含createInstance()方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;serviceLocator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过上面的工厂bean创建bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createClientServiceInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="BeanDefinition继承"><a href="#BeanDefinition继承" class="headerlink" title="BeanDefinition继承"></a>BeanDefinition继承</h3><p><code>BeanDefinition</code>包含很多配置信息，包括构造其参数，属性值、初始化方法等。<code>BeanDefinition</code>之间可以存在继承关系，一个子<code>BeanDefinition</code>能够根据需要覆盖或增加一些值。使用<code>BeanDefinition</code>继承可以节省定义bean的工作量，相当于一种模板。可以通过<code>parent</code>属性来指定父子关系：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParentBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChildBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>xml</code>配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;parentBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.ParentBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;childBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.ChildBean&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;parentBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--覆盖父beanDefinition属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中还可以继承或覆盖构造函数参数、属性、方法、初始化&#x2F;销毁方法、静态工厂设置等信息，但也有一些配置始终是子类配置：</p>
<ul>
<li>depends on</li>
<li>autowire mode</li>
<li>dependency check</li>
<li>singleton</li>
<li>lazy init</li>
</ul>
<p>父<code>BeanDefinition</code>也可以不指定类，只需要将<code>abstract</code>属性设置为<code>true</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;parentBean&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时父<code>bean</code>不能实例化也不能用于<code>ref</code>，只能当作模板来使用</p>
<h2 id="BeanFactory-接口"><a href="#BeanFactory-接口" class="headerlink" title="BeanFactory 接口"></a>BeanFactory 接口</h2><p><code>beanFactory</code> 接口提供了<code>spring ioc</code>基本功能的规范，也是访问<code>ioc</code>容器的根接口</p>
<h2 id="ApplicationContext-接口"><a href="#ApplicationContext-接口" class="headerlink" title="ApplicationContext 接口"></a>ApplicationContext 接口</h2><p><code>ApplicationContext</code>是<code>beanFactory</code> 的一个扩展，它在其基础上添加了更多企业特定的功能，是<code>beanFactory</code>的超集。它补充了如下内容：</p>
<ul>
<li>更容易与<code>Spring AOP</code>集成</li>
<li>消息资源处理（用于国际化）</li>
<li>活动发布</li>
<li>应用特定上下文，注解、配置文件等</li>
</ul>
<p><code>ApplicationContext</code> 接口代表<code>IOC</code>容器。通过读取配置元数据执行<code>bean</code>的实例化、组装和管理。<code>ApplicationContext</code>提供了几种实现，类图如下：</p>
<p><img src="/../../../../images/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%88IOC%EF%BC%89/image-20220425230354337.png" alt="image-20220425230354337"></p>
<h3 id="容器实例化"><a href="#容器实例化" class="headerlink" title="容器实例化"></a>容器实例化</h3><p><code>ApplicationContext</code>的不同实现类用于读取不同的配置元数据：</p>
<ul>
<li>读取<code>xml</code>文件<ul>
<li><code>FileSystemXmlApplicationContext</code></li>
<li><code>ClassPathXmlApplicationContext</code></li>
<li><code>GenericXmlApplicationContext</code></li>
</ul>
</li>
<li>读取<code>Groovy</code>配置<ul>
<li><code>GenericGroovyApplicationContext</code></li>
</ul>
</li>
<li><code>StaticApplicationContext</code></li>
<li>基于<code>Java</code>配置类<ul>
<li><code>AnnotationConfigApplicationContext</code></li>
</ul>
</li>
<li>结合读者委托<ul>
<li><code>GenericApplicationContext</code></li>
</ul>
</li>
</ul>
<h4 id="基于xml-配置"><a href="#基于xml-配置" class="headerlink" title="基于xml 配置"></a>基于<code>xml</code> 配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//提供给 ApplicationContext 构造函数的一个或多个字符串形式的位置路径</span></span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">application</span> <span class="operator">=</span> </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;service.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="基于Groovy-配置"><a href="#基于Groovy-配置" class="headerlink" title="基于Groovy 配置"></a>基于<code>Groovy</code> 配置</h4><p>一般用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericGroovyApplicationContext</span>(<span class="string">&quot;services.groovy&quot;</span>, <span class="string">&quot;daos.groovy&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用读者委托</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GroovyBeanDefinitionReader</span>(context)    </span><br><span class="line">        .loadBeanDefinitions(<span class="string">&quot;services.groovy&quot;</span>, <span class="string">&quot;daos.groovy&quot;</span>);</span><br><span class="line"></span><br><span class="line">    context.refresh();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="基于Java-注解配置"><a href="#基于Java-注解配置" class="headerlink" title="基于Java 注解配置"></a>基于<code>Java</code> 注解配置</h4><p><strong>方式一</strong>：通过指定配置类或组件类，读取其上声明的组件扫描器，进而读取包内的<code>bean</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动器代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MyConfig.class);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> ctx.getBean(<span class="string">&quot;person&quot;</span>, Person.class);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//组件扫描</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong>：通过register方法进行注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">    ctx.register(AppConfig.class, OtherConfig.class);</span><br><span class="line">    ctx.register(AdditionalConfig.class);</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> ctx.getBean(MyService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AnnotationConfigApplicationContext</code>是<code>spring 3.0</code>引入的。种通用<code>ApplicationContext</code>的实现不仅能够接受 <code>@Configuration</code>类作为输入，还能够接受普通<code>@Component</code>类和使用 <code>JSR-330</code> 元数据注释的类</p>
<ul>
<li>当<code>@Configuration</code>类作为输入提供时，<code>@Configuration</code>类本身被注册为 <code>beanDefinition</code>，并且<code>@Bean</code>类中所有声明的方法也被注册为<code>beanDefinition</code>；</li>
<li>当<code>@Component</code>提供 <code>JSR-330</code> 类时，它们被注册为<code>beanDefinition</code>，并且根据提供的<code>@Autowired</code>或<code>@Inject</code>进行依赖注入；</li>
</ul>
<h4 id="基于Reader委托"><a href="#基于Reader委托" class="headerlink" title="基于Reader委托"></a>基于<code>Reader</code>委托</h4><p>不同<code>Reader</code>负责读取不同来源的信息：</p>
<ul>
<li><code>AnnotatedBeanDefinitionReader</code></li>
<li><code>XmlBeanDefinitionReader</code></li>
<li><code>GroovyBeanDefinitionReader</code></li>
<li><code>PropertiesBeanDefinitionReader</code>（已过时）</li>
</ul>
<p><code>GenericApplicationContext</code>可以结合不同<code>Reader</code>来读取对应的配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">    <span class="comment">//用对应的Reader包装上下文对象</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(context)</span><br><span class="line">        <span class="comment">//加载对应bean配置</span></span><br><span class="line">        .loadBeanDefinitions(<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//最后需要刷新上下文</span></span><br><span class="line">    context.refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="附加功能"><a href="#附加功能" class="headerlink" title="附加功能"></a>附加功能</h3><p>开头介绍了位于<code>org.springframework.context</code>包内的 <code>ApplicationContext</code> 类提供了几个附加功能，下面逐个介绍</p>
<h4 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h4><p><code>ApplicationContext</code>扩展了一个<code>MessageSource</code>接口，这个接口提供了国际化功能。该接口介绍如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageSource</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//用于从MessageSource找到指定语言环境的消息，如果未找到，使用默认消息</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getMessage</span><span class="params">(String code, <span class="meta">@Nullable</span> Object[] args, <span class="meta">@Nullable</span> String defaultMessage, Locale locale)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//与上一个方法基本相同，只不过这个不能指定默认消息，找不到消息直接报错</span></span><br><span class="line">    String <span class="title function_">getMessage</span><span class="params">(String code, <span class="meta">@Nullable</span> Object[] args, Locale locale)</span> <span class="keyword">throws</span> NoSuchMessageException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上述方法中使用的所有属性都包装在一个名为MessageSourceResolvable中</span></span><br><span class="line">    String <span class="title function_">getMessage</span><span class="params">(MessageSourceResolvable resolvable, Locale locale)</span> <span class="keyword">throws</span> NoSuchMessageException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>spring</code>在加载<code>ApplicationContext</code>时会自动搜索类型和名称为<code>MessageSource</code>的<code>bean</code>，如果找到了，就将所有信息的调用委托给这个信息源。如果没有找到，则从父容器查找同名<code>bean</code>，如果还没找到，则实例化一个空的<code>DelegatingMessageSource</code>用来接受上述的方法调用。</p>
<p><code>spring</code>提供了三个<code>MessageSource</code>的实现：<code>ResourceBundleMessageSource</code>、<code>ReloadableResourceBundleMessageSource</code>和<code>StaticMessageSource</code>，他们都实现了 <code>HierarchicalMessageSource</code>接口，用来嵌套消息。其中<code>StaticMessageSource</code>很少使用，示例如下</p>
<p><code>ResourceBundleMessageSource</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basenames&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>format<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>exception<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置字符集，解决中文乱码--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面示例配置了两个资源文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#format.properties </span></span><br><span class="line"><span class="attr">name</span>=<span class="string">马冬梅</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#exceptions.propertie</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">马什么梅</span></span><br></pre></td></tr></table></figure>

<p>获取消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MessageSource</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> resources.getMessage(<span class="string">&quot;name&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Default&quot;</span>, Locale.CHINA);</span><br><span class="line">    System.out.println(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果正常情况会输出”马冬梅”。程序会顺序查找定义的<code>basenames</code>列表中配置的配置文件。对于每个配置文件都可以设置不同的语言环境，只需要在properties文件名后加上语言环境。拿上面的例子举例</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#format.properties 下面两个不匹配会选这个，作为备胎</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">xxx</span></span><br><span class="line"><span class="comment">#format_en_GB.properties</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">madongmei</span></span><br><span class="line"><span class="comment">#format_zh_CN.properties</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">马冬梅</span></span><br></pre></td></tr></table></figure>

<p>只需要更改第四个参数就可以读取不同配置文件了，不了解添加什么后缀可以看<code>Locale</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resources.getMessage(<span class="string">&quot;name&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Default&quot;</span>, Locale.CHINA);</span><br></pre></td></tr></table></figure>



<h4 id="标准和自定义事件"><a href="#标准和自定义事件" class="headerlink" title="标准和自定义事件"></a>标准和自定义事件</h4><p><code>spring</code>中时间是通过<code>ApplicationEvent</code>和<code>ApplicationListener</code>接口提供的。如果自定义~实现<code>ApplicationListener</code>接口，每次<code>ApplicationEvent</code>发布到<code>ApplicationContext</code>，都会通知该<code>bean</code> </p>
<h5 id="标准事件"><a href="#标准事件" class="headerlink" title="标准事件"></a>标准事件</h5><p><code>spring</code>内置事件</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>ContextRefreshedEvent</td>
<td>上下文初始化或刷新时发布。初始化表示所有<code>bean</code>都已加载，后置处理器执行，单例被实例化并且上下文对象已准备好使用。刷新戴白哦热刷新或直接调用<code>refresh()</code>方法手动刷新</td>
</tr>
<tr>
<td>ContextStartedEvent</td>
<td>上下文已启动时发布</td>
</tr>
<tr>
<td>ContextStoppedEvent</td>
<td>上下文停止时发布</td>
</tr>
<tr>
<td><code>ContextClosedEvent</code></td>
<td>上下文关闭时发布</td>
</tr>
<tr>
<td>RequestHandledEvent</td>
<td>一个<code>http</code>请求已获得服务，请求完成后发布，只适用于web的DispatcherServlet</td>
</tr>
<tr>
<td>ServletRequestHandledEvent</td>
<td>RequestHandledEvent的父类</td>
</tr>
</tbody></table>
<h5 id="基于代码自定义事件"><a href="#基于代码自定义事件" class="headerlink" title="基于代码自定义事件"></a>基于代码自定义事件</h5><p><strong>自定义事件</strong>，首先创建类集成<code>ApplicationEvent</code> 类并声明初始化方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCustomEvent</span><span class="params">(Object source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后定义<strong>事件发布者</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomPublisher</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventPublisherAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher publisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.publisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发布自定义事件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//该方法是阻塞式的</span></span><br><span class="line">        publisher.publishEvent(<span class="keyword">new</span> <span class="title class_">MyCustomEvent</span>(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义<strong>事件监听</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;MyCustomEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收到事件后，触发该方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(MyCustomEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">//业务逻辑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面定义的三个类都需要注册到容器中，没啥营养这里不再列出。<code>spring</code>运行时会检测到<code>MyCustomPublisher</code>并自动调用<code>setApplicationEventPublisher</code>方法传入<code>spring</code>容器本身。通过其<code>ApplicationEventPublisher</code>接口的<code>publishEvent</code>方法发布事件，然后阻塞，之到接收者接收到事件进行处理。</p>
<h5 id="基于注释的事件监听器"><a href="#基于注释的事件监听器" class="headerlink" title="基于注释的事件监听器"></a>基于注释的事件监听器</h5><p>还是根据上面例子，改为基于注解的方式的监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomListener</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收到事件后，触发该方法</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(MyCustomEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">//业务逻辑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要<strong>监听多个事件</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener(&#123;ContextStartedEvent.class, ContextRefreshedEvent.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleContextStart</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以添加<strong>监听事件的条件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener(condition = &quot;#blEvent.content == &#x27;my-event&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(MyCustomEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">//业务逻辑...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>时间的SpEL表达式可以使用如下数据</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>Event</td>
<td>ApplicationEvent</td>
<td><code>#root.event</code> 或者 <code>event</code></td>
</tr>
<tr>
<td>参数数组</td>
<td>访问参数数组</td>
<td><code>#root.args[i]</code> 或 <code>args[i]</code></td>
</tr>
<tr>
<td>参数名称</td>
<td>任何方法参数和名称</td>
<td><code>#blEvent</code> o或<code>#a0</code></td>
</tr>
</tbody></table>
<h5 id="异步监听器"><a href="#异步监听器" class="headerlink" title="异步监听器"></a>异步监听器</h5><p>使用<code>@Async</code>开启异步监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(MyCustomEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">//业务逻辑...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步监听不能通过返回值来发布后续事件。如果发生异常也不会传播给调用者</p>
<h5 id="监听顺序"><a href="#监听顺序" class="headerlink" title="监听顺序"></a>监听顺序</h5><p>使用<code>@Order</code>注解可以设置监听器监听顺序（越小优先级越高）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@EventListener</span><br><span class="line">@Order(42)</span><br><span class="line">public void onApplicationEvent(MyCustomEvent event) &#123;</span><br><span class="line">    //业务逻辑...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="通用事件监听"><a href="#通用事件监听" class="headerlink" title="通用事件监听"></a>通用事件监听</h5><p>可以通过泛型进一步定义事件结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPersonCreated</span><span class="params">(MyCustomEvent&lt;Animal&gt; event)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="访问底层资源"><a href="#访问底层资源" class="headerlink" title="访问底层资源"></a>访问底层资源</h4><p><a href="./Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE">点击跳转</a></p>
<h4 id="应用程序启动追踪"><a href="#应用程序启动追踪" class="headerlink" title="应用程序启动追踪"></a>应用程序启动追踪</h4><p>todo </p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><p><code>ApplicationContext</code>是一个高级工厂的接口，能够维护不同 bean 及其依赖项的注册表。通过<code>getBean</code>方法</p>
<ul>
<li><code>getType(...)</code>：调用指定的<code>bean</code>名称，确定bean运行时类型</li>
<li><code>getBean(...)</code>：获取<code>bean</code>实例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建和配置beans</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;services.xml&quot;</span>, <span class="string">&quot;daos.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取bean</span></span><br><span class="line"><span class="type">PetStoreService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;petStore&quot;</span>, PetStoreService.class);</span><br></pre></td></tr></table></figure>



<h2 id="元数据详细配置"><a href="#元数据详细配置" class="headerlink" title="元数据详细配置"></a>元数据详细配置</h2><p>配置元数据表示在应用程序中<code>Spring</code>应该如何实例化、配置和组装<code>bean</code>。一般使用<code>xml</code>格式提供，但也可以使用<a href="#%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AE%B9%E5%99%A8">其他形式</a></p>
<h3 id="xml-配置"><a href="#xml-配置" class="headerlink" title="xml 配置"></a>xml 配置</h3><p> <code>XML</code> 的配置元数据基本格式如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;misterkaoli&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Spring</code>也支持嵌套属性标签，在解析时会将内部元素<code>&lt;value/&gt;</code>的文本转换为的对应属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mappings&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.PropertySourcesPlaceholderConfigurer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 类型为 java.util.Properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            jdbc.driver.className=com.mysql.jdbc.Driver</span><br><span class="line">            jdbc.url=jdbc:mysql://localhost:3306/mydb</span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>p-namespace</code>允许使用bean标签的属性代替<code>&lt;property/&gt;</code>子标签，如下所示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;someone@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spouse&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jane&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--等价于--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.ExampleBean&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:email</span>=<span class="string">&quot;someone@somewhere.com&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:spouse-ref</span>=<span class="string">&quot;jane&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--等价于--&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>&lt;c-namespace&gt;</code>允许使用bean标签属性代替<code>&lt;constructor-arg&gt;</code>子标签，如下所示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- traditional declaration with optional argument names --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;thingTwo&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanTwo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;thingThree&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanThree&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;something@somewhere.com&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--等价于--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">c:thingTwo-ref</span>=<span class="string">&quot;beanTwo&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:thingThree-ref</span>=<span class="string">&quot;beanThree&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">c:email</span>=<span class="string">&quot;something@somewhere.com&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>复合属性名称</p>
<p>当一个bean中由属性A，A包含属性B，B又包含属性C，此时我想要给C赋值，就可以使用符合属性名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;test&quot; class=&quot;test.TestBean&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;A.B.C&quot; value=&quot;123&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>



<h4 id="lt-bean-gt"><a href="#lt-bean-gt" class="headerlink" title="&lt;bean&gt;"></a><code>&lt;bean&gt;</code></h4><p><code>&lt;bean&gt;</code>标签内容如下：</p>
<ul>
<li>**<code>id</code>**：指定一个字符串，表示bean的标识符，由字母、数字和特殊字符组成，只能指定一个；</li>
<li>**<code>name</code>**：能指定多个标识符，不同标识符用逗号、分号或空格分隔；</li>
<li>**<code>class</code>**：使用完全限定的类名定义<code>bean</code>的类型；</li>
<li>**<code>scope</code>**：<code>bean</code>的作用域，[详细说明](#bean 作用域)</li>
<li>**<code>destroy-method</code>**：指定销毁回调方法，<a href="#%E9%94%80%E6%AF%81%E5%9B%9E%E8%B0%83">详细说明</a></li>
<li>**<code>init-method</code>**：指定初始化回调方法，<a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9B%9E%E8%B0%83">详细说明</a></li>
<li>**<code>parent</code>**：指定<code>BeanDefinition</code>的父子关系，<a href="#BeanDefinition%E7%BB%A7%E6%89%BF">详细说明</a></li>
<li>**<code>abstract</code>**：指定<code>BeanDefinition</code>是否是纯模板，<a href="#BeanDefinition%E7%BB%A7%E6%89%BF">详细说明</a></li>
<li>**<code>&lt;lookup-method&gt;</code>**：通过方法注入<code>bean</code>，<a href="#%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5">详细说明</a></li>
<li>**<code>&lt;replaced-method&gt;</code>**：替换目标<code>bean</code>的方法，<a href="#%E4%BB%BB%E6%84%8F%E6%96%B9%E6%B3%95%E6%9B%BF%E6%8D%A2">详细说明</a></li>
<li>**<code>depends-on</code>**：显式指定一个或多个单例的<code>bean</code>在初始化&#x2F;销毁当前<code>bean</code>之前进行初始化&#x2F;销毁，多个<code>bean</code>使用逗号、空格和分包分隔；</li>
<li>**<code>lazy-init</code>**：<code>bean</code>懒加载，在第一次使用到时才加载；</li>
<li>**<code>autowire</code>**：为bean定义指定自动装配模式，<code>&lt;property&gt;</code>和<code>&lt;constructor-arg/&gt;</code>的依赖项会覆盖自动装配，不能装配简单属性<ul>
<li><code>no</code>：没有自动装配（默认）</li>
<li><code>byName</code>：按属性名称自动装配，若未找到，则不设置属性值</li>
<li><code>byType</code>：按属性类型自动装配，若未找到，则不设置属性值</li>
<li><code>constructor</code>：类似与<code>byType</code>，但是指定的是构造函数参数，若未找到，则报错</li>
</ul>
</li>
<li>**<code>autowire-candidate</code>**：设置为<code>false</code>，则按类型的自动装配不可用（包括<code>@Autowired</code>注解），不会影响按名称的引用；</li>
<li>**<code>default-autowire-candidates</code>**：通过表达式限制bean的名称，多个表达式以逗号分隔。例如<code>*Repository</code>指定依赖的<code>bean</code>必须以<code>Repository</code>结尾；</li>
<li>**<code>&lt;property&gt;</code>**：定义bean的属性<ul>
<li>**<code>name</code>**：<code>JavaBean</code>属性的名称</li>
<li>**<code>value</code>**：属性的值，<code>spring</code>会自动将值转换为实际类型</li>
<li>**<code>&lt;value&gt;</code>**：作用同<code>value</code>，一般值比较复杂时使用</li>
<li>**<code>ref</code>**：所引用<code>Bean</code>的定义名称</li>
<li>**<code>&lt;ref&gt;</code>**：功能同<code>ref</code><ul>
<li>**<code>bean</code>**：目标<code>bean</code>名称</li>
<li>**<code>parent</code>**：通过该属性指定目标<code>bean</code>是对当前容器父容器中的<code>bean</code>的引用</li>
</ul>
</li>
<li>**<code>idref</code>**：一个防错方式，功能类似<code>value</code>属性，但他会在会在容器部署时查看指定<code>id</code>的<code>bean</code>是否存在，而不是在实例化时；</li>
<li>**<code>&lt;bean&gt;</code>**：内部<code>bean</code>定义不需要指定id或name，创建时会忽略<code>id</code>、<code>name</code>和<code>scope</code>。这是个匿名<code>bean</code>，外部的其他<code>bean</code>不能访问</li>
<li>**<code>&lt;list&gt;</code>**：<code>List</code>类型，<a href="#%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7">详细说明</a></li>
<li>**<code>&lt;set&gt;</code>**：<code>set</code>类型，<a href="#%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7">详细说明</a></li>
<li>**<code>&lt;map&gt;</code>**：<code>map</code>类型，<a href="#%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7">详细说明</a></li>
<li>**<code>&lt;props&gt;</code>**：<code>props</code>类型，<a href="#%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7">详细说明</a></li>
<li>**<code>&lt;null/&gt;</code>**：表示<code>null</code>值</li>
</ul>
</li>
<li>**<code>&lt;constructor-arg/&gt;</code>**：构造函数实例化<code>bean</code>时的的参数<ul>
<li><strong><code>name</code><strong>：<code>JavaBean</code>中构造函数的</strong>参数名</strong></li>
<li>**<code>value</code>**：参数的值，<code>spring</code>会自动将值转换为实际类型</li>
<li>**<code>type</code>**：参数类型</li>
<li>**<code>index</code>**：参数索引，从0开始</li>
<li>**<code>ref</code>**：所引用<code>Bean</code>的定义名称</li>
</ul>
</li>
<li>**<code>&lt;qualifier&gt;</code>**：[详细说明](#@Qualifier 对应的 xml 配置)</li>
</ul>
<h5 id="集合属性"><a href="#集合属性" class="headerlink" title="集合属性"></a>集合属性</h5><p>可以使用<code>&lt;list/&gt;</code>，<code>&lt;set/&gt;</code>，<code>&lt;map/&gt;</code>，和<code>&lt;props/&gt;</code>标签表示<code>Collection</code>类型<code>List</code>，<code>Set</code>，<code>Map</code>，和<code>Properties</code>详细配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myProperties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--Properties单个值的定义--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p2&quot;</span>&gt;</span>p2<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--list单个值的定义--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>l1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--引用外部bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--list和set还可以定义其他任意集合元素--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--map单个值的定义--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;k1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;v1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--key和value都可以引用外部bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mySet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--set单个值的定义--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>s1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--引用外部bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--set和list还可以定义其他任意集合元素--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.RefBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面引用的java类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List myList;</span><br><span class="line">    <span class="keyword">private</span> Set mySet;</span><br><span class="line">    <span class="keyword">private</span> Map myMap;</span><br><span class="line">    <span class="keyword">private</span> Properties myProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="集合合并"><a href="#集合合并" class="headerlink" title="集合合并"></a>集合合并</h5><p><code>Spring</code>容器还支持集合合并，可以定义父<code>&lt;list/&gt;</code>，<code>&lt;map/&gt;</code>，<code>&lt;set/&gt;</code>或<code>&lt;props/&gt;</code>元素，然后定义其子元素，这样最终子元素的值就是子集合和父集合的并集，如果有相同的元素，子集合会覆盖父集合的值，配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.CollectionMerge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myProperties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p2&quot;</span>&gt;</span>p2<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--指明parent，不需要指明class--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;child&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myProperties&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--子集合指定merge=&quot;true&quot;开启集合合并--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span> <span class="attr">merge</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p2&quot;</span>&gt;</span>p22<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;p3&quot;</span>&gt;</span>p33<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应的<code>bean</code>类如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectionMerge</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Properties myProperties;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终子集合的结果为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CollectionMerge(myProperties=&#123;p3=p33, p2=p22, p1=p1&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>补充：</strong></p>
<ul>
<li>如果不指定<code>id</code>和<code>name</code>，容器会为该<code>bean</code>生成一个唯一名称。但如果想根据名称引用<code>bean</code>，则需要指定名称；</li>
<li>对于指定泛型的集合<code>Spring</code>会自动进行转换；</li>
</ul>
<h4 id="lt-import-gt"><a href="#lt-import-gt" class="headerlink" title="&lt;import&gt;"></a><code>&lt;import&gt;</code></h4><p><code>&lt;import&gt;</code>标签内容如下：</p>
<ul>
<li><code>resource</code>：其他<code>xml</code>文件位置。默认位置路径是相对于当前<code>xml</code>文件的，也可以使用绝对路径。不建议使用 <em>..&#x2F;</em> 和 <em>classpath:URL</em>，因为这样会创建当前应用程序之外的文件的依赖关系</li>
</ul>
<h4 id="lt-alias-gt"><a href="#lt-alias-gt" class="headerlink" title="&lt;alias&gt;"></a><code>&lt;alias&gt;</code></h4><p><code>&lt;alias&gt;</code>标签内容如下：</p>
<ul>
<li><code>name</code>：<code>bean</code>名字</li>
<li><code>alias</code>：别名</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;fromName&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;toName&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="lt-beans-gt"><a href="#lt-beans-gt" class="headerlink" title="&lt;beans&gt;"></a><code>&lt;beans&gt;</code></h4><p><code>&lt;beans&gt;</code>标签内容如下：</p>
<ul>
<li>**<code>default-init-method</code>**：默认初始化回调，<a href="#%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81%E6%96%B9%E6%B3%95">详细介绍</a></li>
<li>**<code>default-destroy-method</code>**：默认销毁回调，<a href="#%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81%E6%96%B9%E6%B3%95">详细介绍</a></li>
<li>**<code>profile</code>**：项目配置环境</li>
</ul>
<p><code>&lt;beans&gt;</code>标签可以内嵌<code>&lt;beans&gt;</code>标签</p>
<h5 id="profile-示例"><a href="#profile-示例" class="headerlink" title="profile 示例"></a>profile 示例</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 不同环境使用不同的bean配置，也可以把beans拆分为多个xml文件 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;production&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="lt-context-XXX-gt"><a href="#lt-context-XXX-gt" class="headerlink" title="&lt;context:XXX&gt;"></a><code>&lt;context:XXX&gt;</code></h4><h5 id="注解组件扫描"><a href="#注解组件扫描" class="headerlink" title="注解组件扫描"></a>注解组件扫描</h5><p><code>&lt;context:component-scan/&gt;</code>标签内容如下：</p>
<ul>
<li>**<code>base-package</code>**：要扫描的包</li>
<li>**<code>&lt;context:include-filter&gt;</code>**：扫描过滤器，<a href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E8%BF%87%E6%BB%A4">查看详情</a></li>
<li>**<code>&lt;context:exclude-filter/&gt;</code>**：扫描过滤器，<a href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E8%BF%87%E6%BB%A4">查看详情</a></li>
</ul>
<p><strong>扫描包配置</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;test.annotation&quot;</span>&gt;&lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>

<p>使用<code>&lt;context:component-scan&gt;</code>隐式启用 <code>&lt;context:annotation-config&gt;</code>。<code>&lt;context:component-scan&gt;</code>使用时通常不需要包含 <code>&lt;context:annotation-config&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;context:annotation-config/&gt;</code>的作用是引入了以下后置处理器，用于处理了相应注解：</p>
<ul>
<li><code>ConfigurationClassPostProcessor</code></li>
<li><code>AutowiredAnnotationBeanPostProcessor</code>：<ul>
<li><code>@Autowired</code></li>
</ul>
</li>
<li><code>CommonAnnotationBeanPostProcessor</code>：<ul>
<li><code>@Resource</code> </li>
<li><code>@PostConstruct</code></li>
<li><code>@PreDestroy</code></li>
</ul>
</li>
<li><code>PersistenceAnnotationBeanPostProcessor</code>：<ul>
<li><code>@PersistenceContext</code></li>
</ul>
</li>
<li><code>EventListenerMethodProcessor</code>：</li>
</ul>
<h5 id="引入properties文件"><a href="#引入properties文件" class="headerlink" title="引入properties文件"></a>引入properties文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>jdbc.properties</code>内容如下</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.properties</span> <span class="string"></span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:hsqldb:hsql://localhost/xdb </span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">sa </span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">111111</span></span><br></pre></td></tr></table></figure>



<h3 id="java-注解配置"><a href="#java-注解配置" class="headerlink" title="java 注解配置"></a>java 注解配置</h3><p>此处只列出spring常用和官方提供的注解，如果想要查看其他注解，索引如下</p>
<ul>
<li><code>JSR 330</code> 标准注释：[查看详情](#JSR 330 标准注释)</li>
</ul>
<h4 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h4><p><strong>使用范围</strong></p>
<ul>
<li>类</li>
<li>方法</li>
</ul>
<p><strong>作用</strong></p>
<p>用来将<code>bean</code>加入到<code>ioc</code>容器中，[查看详情](#@Bean 注解)</p>
<h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h4><p><strong>使用范围</strong></p>
<ul>
<li>构造方法</li>
<li>属性</li>
</ul>
<p><strong>属性</strong></p>
<ul>
<li><code>required</code>：是否必须。默认为<code>true</code>，若不存在则会报错。详细内容下文列出</li>
</ul>
<p><strong>作用</strong></p>
<p>用于注入属性，[详细内容](#@Autowired 注解)</p>
<h4 id="Resouece"><a href="#Resouece" class="headerlink" title="@Resouece"></a>@Resouece</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法</li>
<li>字段</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>注入bean依赖，[查看详情](#@Resource 注解)</li>
</ul>
<h4 id="ConstructorProperties"><a href="#ConstructorProperties" class="headerlink" title="@ConstructorProperties"></a>@ConstructorProperties</h4><p><strong>使用范围</strong></p>
<ul>
<li>构造方法</li>
</ul>
<p><strong>作用</strong></p>
<p>显示命名构造方法的参数，<a href="#%E5%9F%BA%E4%BA%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">查看详情</a></p>
<h4 id="Required-弃用"><a href="#Required-弃用" class="headerlink" title="@Required (弃用)"></a>@Required (弃用)</h4><p><strong>使用范围</strong></p>
<ul>
<li>作用在<code>setXXX()</code>的方法上</li>
</ul>
<p><strong>作用</strong></p>
<p>只起到提示的作用，如果注释的方法所对应的<code>bean</code>没有配置，就会报错。<code>spring 5.1</code>已经弃用<code>@Required</code>注解，推荐使用构造函数注入进行所需设置。</p>
<h4 id="Lookup"><a href="#Lookup" class="headerlink" title="@Lookup"></a>@Lookup</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>用来指定需要注入的方法，点击<a href="#%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5">方法注入</a>查看例子</li>
</ul>
<h4 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>指定<code>bean</code>初始化回调方法，<a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9B%9E%E8%B0%83">查看详情</a></li>
</ul>
<h4 id="PreDestroy"><a href="#PreDestroy" class="headerlink" title="@PreDestroy"></a>@PreDestroy</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>指定<code>bean</code>销毁回调方法，<a href="#%E9%94%80%E6%AF%81%E5%9B%9E%E8%B0%83">详细说明</a></li>
</ul>
<h4 id="Primary"><a href="#Primary" class="headerlink" title="@Primary"></a>@Primary</h4><p><strong>使用范围</strong></p>
<ul>
<li><code>@bean</code>注解的方法上</li>
<li>组件类上</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>指定优先的候选项，[查看详情](#@primary 注解)</li>
</ul>
<h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法参数</li>
<li>和<code>@Autowired</code>配合使用</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>根据名字过滤<code>bean</code>，[查看详情](#@Qualifier 注解)</li>
</ul>
<h4 id="PropertySource"><a href="#PropertySource" class="headerlink" title="@PropertySource"></a>@PropertySource</h4><p><strong>使用范围</strong></p>
<ul>
<li>配置类上</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>读取外部配置，<a href="#@PropertySource%E6%B3%A8%E8%A7%A3">查看详情</a></li>
</ul>
<h4 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h4><p><strong>使用范围</strong></p>
<ul>
<li>方法参数</li>
<li>字段</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>读取外部配置，[查看详情](#@Value 注解)</li>
</ul>
<h4 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h4><p><strong>使用范围</strong></p>
<ul>
<li>@bean标记的方法</li>
<li>组件注解标记的类</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>为<code>bean</code>设置作用域，[查看详情](#@Scope 注解)</li>
</ul>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><p><strong>使用范围</strong></p>
<ul>
<li>配置类</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>声明配置类，[查看详情](#@Configuration 注解)</li>
</ul>
<h4 id="import"><a href="#import" class="headerlink" title="@import"></a>@import</h4><p><strong>使用范围</strong></p>
<ul>
<li>配置类</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>导入外部配置类，[查看详情](#@import 注解)</li>
</ul>
<h4 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h4><p><strong>使用范围</strong></p>
<ul>
<li><code>@bean</code>标记的方法</li>
<li>配置类上</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>用于判断配置类或<code>bean</code>是否引入，[查看详情](#@Conditional 注解)</li>
</ul>
<h4 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h4><p><strong>使用范围</strong></p>
<ul>
<li>配置类</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>引入外部<code>xml</code>文件，[查看详情](#@ImportResource 注解)</li>
</ul>
<h4 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h4><p><strong>使用范围</strong></p>
<ul>
<li>配置类</li>
<li>组件类</li>
<li><code>@bean</code>方法</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>根据当前环境判断注释的类或<code>bean</code>是否应该被注册，[查看详情](#@Profile 注解)</li>
</ul>
<h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><p><strong>使用范围</strong></p>
<ul>
<li><code>bean</code>类上</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li>声明组件类并注册到<code>ioc</code>容器中，又根据语义不同用其封装了多个注解，[查看详情](#@Component 及其组合注解)</li>
</ul>
<h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><p>依赖注入就是在容器创建<code>bean</code>时注入所需要的依赖项，依赖注入由两种方式：</p>
<ul>
<li>基于构造函数的依赖注入</li>
<li>基于 <code>Setter</code> 的依赖注入</li>
</ul>
<h3 id="基于构造函数的依赖注入"><a href="#基于构造函数的依赖注入" class="headerlink" title="基于构造函数的依赖注入"></a>基于构造函数的依赖注入</h3><p>基于构造函数的<code>DI</code>是通过让其调用具有多个参数的构造函数来完成的，每个参数代表一个依赖项。和静态工厂方法构造<code>bean</code>几乎是等效的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前bean</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> RefBean refBean;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestBean</span><span class="params">(String name, <span class="type">int</span> age, RefBean refBean)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.refBean = refBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被引用的bean</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过构造方法进行依赖注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.RefBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以通过<code>@ConstructorProperties</code>注解代替<code>xml</code>配置文件，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConstructorProperties(&#123;&quot;name&quot;,&quot;age&quot;,&quot;refBean&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TestBean</span><span class="params">(String name1, <span class="type">int</span> age1, RefBean refBean)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name1;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.refBean = refBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="构造参数函数解析"><a href="#构造参数函数解析" class="headerlink" title="构造参数函数解析"></a>构造参数函数解析</h4><p> <code>&lt;constructor-arg/&gt;</code> 标签中如果不指定<code>name</code>属性，参数会按照顺序传入构造函数，只要参数类型都对应正确，属性就能正确注入。如果参数类型对应不上，比如把 <code>&lt;constructor-arg/&gt;</code> 标签位置调换一下，那么就会报错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--运行会报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了防止这种问题的发生，可以指定<code>name</code>、<code>index</code>或<code>type</code>属性，这三个属性指的都是构造函数的参数，目的就是消除歧义。下面以<code>name</code>举例（<a href="#%60%3Cbean%3E%60">点击查看其他属性</a>）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--运行成功--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>另外，可以通过 [@ConstructorProperties()](# @ConstructorProperties)注解指定构造函数的参数</p>
<h3 id="基于-Setter-的依赖注入"><a href="#基于-Setter-的依赖注入" class="headerlink" title="基于 Setter 的依赖注入"></a>基于 Setter 的依赖注入</h3><p>基于 <code>Setter</code> 的 <code>DI</code> 是通过容器在调用无参数构造函数或无参数<code>static</code>工厂方法来实例化bean 后调用 bean 上的 setter 方法来完成的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> RefBean refBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被引用bean</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 <code>Setter</code> 进行依赖注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.RefBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;李四&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="#%60%3Cbean%3E%60">点击查看标签属性</a></p>
<p>基于构造函数和 setter 两种方式可以混合使用，也就是通过构造函数注入依赖项后，还支持使用 setter 进行依赖注入，下面配置是可行的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;refBean&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;refBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="依赖注入方式的选择"><a href="#依赖注入方式的选择" class="headerlink" title="依赖注入方式的选择"></a>依赖注入方式的选择</h3><h4 id="选择规则"><a href="#选择规则" class="headerlink" title="选择规则"></a>选择规则</h4><ul>
<li>对必须依赖项使用构造函数，<code>Spring</code>官方提倡使用构造函数注入，理由如下：<ul>
<li>这样可以将应用程序组件实现为不可变对象，并确保所需的依赖项不是<code>null</code>；</li>
<li>构造函数注入的组件大多是以初始化完毕的状态返回的；</li>
</ul>
</li>
<li>对可选依赖项使用<code>setter</code>，理由如下：<ul>
<li>如果只使用<code>setter</code>，则必须在代码使用依赖项的任何地方执行非空检查；</li>
<li>可以在在<code>setter</code>方法上使用 <a href="#@Required">@Request</a> 注释可用于使属性成为必须的依赖项；</li>
<li>对于不公开任何setter函数的第三方类，构造函数注入可能是唯一可用形式；</li>
</ul>
</li>
</ul>
<h4 id="依赖解析过程"><a href="#依赖解析过程" class="headerlink" title="依赖解析过程"></a>依赖解析过程</h4><p>容器执行bean依赖解析过程如下：</p>
<ul>
<li>使用<code>ApplicationContext</code>扫描所有的配置元数据执行 <code>bean</code> 创建和初始化。配置元数据可以由 XML、Java 代码或注释指定；</li>
<li>对于每个 bean，它的依赖关系以属性、构造函数参数或静态工厂方法的参数（如果您使用它而不是普通构造函数）的形式表示。在实际创建 bean 时，将这些依赖关系提供给 bean；</li>
<li>每个属性或构造函数参数都是要设置的值的实际定义，或者是对容器中另一个 bean 的引用；</li>
<li>作为值的每个属性或构造函数参数都从其指定格式转换为该属性或构造函数参数的实际类型。默认情况下，Spring 可以将以字符串格式提供的值转换为所有内置类型，例如<code>int</code>、 <code>long</code>、<code>String</code>、<code>boolean</code>等；</li>
<li>每个<code>bean</code>作为依赖项注入到其他<code>bean</code>中时就都已经完全配置了；</li>
</ul>
<h5 id="循环依赖"><a href="#循环依赖" class="headerlink" title="循环依赖"></a>循环依赖</h5><p>如果使用构造函数注入，则可能会产生循环依赖。例如A的构造函数需要B，B的构造函数需要依赖A，这样A和B都不会初始化成功，<code>Spring</code>检测到后会抛出<code>BeanCurrentlyInCreationException</code>异常。为了解决这类问题，<code>spring</code>在容器加载时检测配置问题，解析依赖项，并且会尽可能晚的设置属性。</p>
<h2 id="方法注入"><a href="#方法注入" class="headerlink" title="方法注入"></a>方法注入</h2><p>大多数情况下，容器中的<code>bean</code>基本都是单例的。当一个单例的bean依赖另一个非单例的bean时，就可能因为bean的周期不同而出现问题。比如A是单例的，B不是单例的，A依赖B，并且A中有一个方法每次调用都需要B，但A只会在初始化时注入B，无法在每次需要时都为A提供B的新实例。</p>
<p>可以通过实现<code>ApplicationContextAware</code>接口，并在A需要B时调用<code>getBean(&quot;B&quot;)</code>方法获取B实例，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> B <span class="title function_">CreateB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.applicationContext.getBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(String State)</span> &#123;</span><br><span class="line">        <span class="comment">// 从ioc容器中获取B实例</span></span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span>CreateB();</span><br><span class="line">        <span class="comment">// 设置B实例状态</span></span><br><span class="line">        b.setState(State);</span><br><span class="line">        <span class="comment">// 执行业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> b.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//业务代码</span></span><br><span class="line">        System.out.println(state);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式可以解决问题，但A的业务代码与<code>Spring</code>存在耦合。使用方法注入可以更简洁的解决问题，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span>  B <span class="title function_">CreateB</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Lookup</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(String State)</span> &#123;</span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> CreateB();</span><br><span class="line">        b.setState(State);</span><br><span class="line">        <span class="keyword">return</span> b.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码使用<code>@Lookup</code>注解进行配置，如果不使用注解也可以使用<code>xml</code>文件配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.B&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.A&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--b如果是单例，每次返回的都是一个实例，如果不是单例，每次返回不同实例--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lookup-method</span> <span class="attr">name</span>=<span class="string">&quot;CreateB&quot;</span> <span class="attr">bean</span>=<span class="string">&quot;b&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用方法注入后代码量小了很多，而且类中看不到<code>Spring</code>的部分，耦合度也降低了。</p>
<h3 id="查找方法注入"><a href="#查找方法注入" class="headerlink" title="查找方法注入"></a>查找方法注入</h3><p>查找方法注入是一种覆盖被容器管理的<code>bean</code>的方法的功能，通过<code>&lt;lookup-method&gt;</code>标签或<code>@Lookup</code>注解指定<code>bean</code>中应该覆盖的方法并将容器中对应名字的<code>bean</code>作为方法的返回结果返回。<code>Spring</code>会通过<code>CGLIB</code>进行动态代理来动态生成覆盖该方法的子类并实现该方法的注入。使用时需要注意以下内容：</p>
<ul>
<li>需要方法注入的类不能被<code>final</code>修饰，需要注入的方法也不能被<code>final</code>修饰；</li>
<li>对具有<code>abstract</code>方法的类进行单元测试需要自己实现子类和方法？</li>
<li>组件扫描需要到具体类中的具体方法</li>
<li>不适合用于工厂方法，特别是配置类中以<code>@bean</code>修饰的方法，这种情况下，容器不会创建实例，无法在运行时生成子类</li>
</ul>
<p>要注入的方法格式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">public</span>|<span class="keyword">protected</span>&gt; [<span class="keyword">abstract</span>] &lt;<span class="keyword">return</span>-type&gt; theMethodName(no-arguments);</span><br></pre></td></tr></table></figure>

<p>如果方法时<code>abstract</code>的，则动态生成的子类实现该方法，负责，动态生成的子类会覆盖原始类中的具体方法。</p>
<h3 id="任意方法替换"><a href="#任意方法替换" class="headerlink" title="任意方法替换"></a>任意方法替换</h3><p>任意方法替换也可以实现方法注入，但一般没什么用。如果使用<code>xml</code>配置，可以使用 <code>&lt;replaced-method&gt;</code>为已部署的<code>bean</code>中咸鱼的方法替换为另一个方法的实现。举例如下：</p>
<p>假设A中有一个<code>replace()</code>方法，我希望将这个方法替换掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">replace</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是原版的&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是原版的&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义一个<code>ReplaceA</code>并继承<code>MethodReplacer</code>接口实现<code>reimplement</code>方法，这个方法就是用于替换A中的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplaceA</span> <span class="keyword">implements</span> <span class="title class_">MethodReplacer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 被替换的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objects 参数列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reimplement</span><span class="params">(Object o, Method method, Object[] objects)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我要替换A的方法&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我要替换A的方法&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>xml</code>文件中如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;replaceA&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.ReplaceA&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.A&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">replaced-method</span> <span class="attr">name</span>=<span class="string">&quot;replace&quot;</span> <span class="attr">replacer</span>=<span class="string">&quot;replaceA&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg-type</span>&gt;</span>String<span class="tag">&lt;/<span class="name">arg-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">replaced-method</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置完成之后，ioc容器中的A的replace()方法就已经被替换掉了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPathXmlApplicationContext</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;collections.xml&quot;</span>);</span><br><span class="line"><span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> application.getBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">a.replace(); <span class="comment">//输出：我要替换A的方法&quot;</span></span><br></pre></td></tr></table></figure>

<p>在<code>&lt;replaced-method&gt;</code>中可以使用一个或多个<code>&lt;arg-type&gt;</code>来指定被覆盖方法的签名，只有在方法被覆盖并且类中存在多个变体时参数的签名才是必须的</p>
<h2 id="bean-作用域"><a href="#bean-作用域" class="headerlink" title="bean 作用域"></a>bean 作用域</h2><p>声明了一个beanDefination相当于创建了一个这个bean的模板，spring通过这个模板创建多个实例。spring中不仅可以配置bean的依赖和配置，还可以定义beanDefination创建的对象的范围（作用域）。spring定义了六个作用域，下面表格已列出，其中后四个仅在web-aware的上下文情况下有效，另外还可以<a href="#">自定义作用域</a></p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><a href="">singleton</a></td>
<td>单例（默认），每个ioc容器中只有一个该对象实例</td>
</tr>
<tr>
<td><a href="">prototype</a></td>
<td>任意数量的对象实例</td>
</tr>
<tr>
<td><a href="">request</a></td>
<td>单个bean在单个http请求内有效</td>
</tr>
<tr>
<td><a href="">session</a></td>
<td>单个bean在http session内有效</td>
</tr>
<tr>
<td><a href="">application</a></td>
<td>单个bean在ServletContext内有效</td>
</tr>
<tr>
<td><a href="">websocket</a></td>
<td>单个bean在websocket有效</td>
</tr>
</tbody></table>
<h3 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h3><p>当定义一个<code>bean</code>作用域为<code>singleton</code>时，让其会创建该<code>beanDefination</code>的一个实例，存储在单例bean的缓存中，并且对名为该<code>bean</code>的所有后续请求都返回该缓存实例。</p>
<h3 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h3><p><code>scope</code>为<code>prototype</code>时，每次对特定<code>bean</code>发出的请求都会创建一个新的<code>bean</code>实例。可以通过注入或者通过容器的<code>getBean</code>方法来进行请求。通常对一些有状态的<code>bean</code>建议声明为<code>prototype</code>作用域，对无状态的<code>bean</code>使用<code>singleton</code>作用域。</p>
<p><code>spring</code>不会管理<code>prototype</code>的<code>bean</code>的完整的声明周期，只有容器实例化、配置以及组装原型对象并返回给客户端，之后就没有在进一步的操作了.不论作用域是什么，都会调用初始化声明周期回调方法。但是，在<code>prototype</code>情况下不会调用配置的销毁的生命周期回调方法，需要客户端清理<code>prototype</code>的<code>bean</code>并释放所持有的资源，可以通过自定义<a href="">bean post-processor</a>对bean进行清理</p>
<h3 id="使用具有原型依赖的单例bean"><a href="#使用具有原型依赖的单例bean" class="headerlink" title="使用具有原型依赖的单例bean"></a>使用具有原型依赖的单例bean</h3><p>当使用的一个单例<code>bean</code>中需要用到原型<code>bean</code>时可以使用<a href="#%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5">方法注入</a>来解决问题</p>
<h3 id="其他作用域"><a href="#其他作用域" class="headerlink" title="其他作用域"></a>其他作用域</h3><p><code>request</code>，<code>session</code>，<code>application</code>，和<code>websocket</code>这四个作用域仅用于使用一个<code>web-aware</code>的<code>ApplicationContext</code>实现（例如<code>XmlWebApplicationContext</code>）。不在<code>ClassPathXmlApplicationContext</code>等常规容器下使用，否则会报错</p>
<p><strong>todo</strong></p>
<h2 id="自定义bean扩展"><a href="#自定义bean扩展" class="headerlink" title="自定义bean扩展"></a>自定义bean扩展</h2><h3 id="生命周期回调"><a href="#生命周期回调" class="headerlink" title="生命周期回调"></a>生命周期回调</h3><p>可以通过实现<code>InitializingBean</code>和<code>DisposableBean</code>接口的方式与容器对 <code>bean</code> 生命周期的管理进行交互。容器为前者调用 <code>afterPropertiesSet()</code> 为后者调用 <code>destroy()</code> 以让 <code>bean</code> 在初始化和销毁 <code>bean</code> 时执行某些操作。除了初始化和销毁的回调外，还可以实现<code>Lifecycle</code>接口来管理Spring中对象的生命周期。</p>
<h4 id="初始化回调"><a href="#初始化回调" class="headerlink" title="初始化回调"></a>初始化回调</h4><p>可以通过实现<code>InitializingBean</code>接口并重写<code>afterPropertiesSet()</code>方法来进行<code>bean</code>的初始化。但官方不建议使用这种方式，因为它会使业务代码与<code>Spring</code>耦合。建议使用以下方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringLifeCycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bean初始化回调</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化回调&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面使用注解方式，也可以使用<code>xml</code>指定初始化回调方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--init-method 设置 bean初始化回调--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;lifeCycle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.SpringLifeCycle&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="销毁回调"><a href="#销毁回调" class="headerlink" title="销毁回调"></a>销毁回调</h4><p>可以通过实现<code>DisposableBean</code>接口并重写<code>destroy()</code>方法来进行<code>bean</code>的初始化。但官方不建议使用这种方式，因为它会使业务代码与<code>Spring</code>耦合。建议使用以下方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringLifeCycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bean销毁回调</span></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁回调&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面使用注解方式，也可以使用<code>xml</code>指定销毁回调方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--destroy-method 设置 bean初始化回调--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;lifeCycle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.SpringLifeCycle&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="默认初始化和销毁方法"><a href="#默认初始化和销毁方法" class="headerlink" title="默认初始化和销毁方法"></a>默认初始化和销毁方法</h4><p>在<code>&lt;beans&gt;</code>顶级标签上可以定义默认的回调方法名，这样在此<code>&lt;beans&gt;</code>标签内的<code>&lt;bean&gt;</code>标签如果不指定默认的初始化回调那么就会使用设置的默认的回调名的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringLifeCycle</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化回调&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁回调&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>xml</code>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">default-destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;lifeCycle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test.pojo.SpringLifeCycle&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="多个生命周期机制"><a href="#多个生命周期机制" class="headerlink" title="多个生命周期机制"></a>多个生命周期机制</h4><p> 上面说明了三种配置生命周期回调的机制：</p>
<ul>
<li>在<code>InitializingBean</code>和 <code>DisposableBean</code>回调接口</li>
<li>自定义<code>init()</code>和<code>destroy()</code>方法，使用<code>xml</code>配置</li>
<li>使用<code>@PostConstruct</code>和<code>@PreDestroy</code> 注释修饰方法</li>
</ul>
<p>一个<code>bean</code>可能通过不同机制配置多个回调函数，如果每个配置的方法名都一样，那么只会执行一次，否则每个配置的方法会按照如下顺序执行：</p>
<ol>
<li>用<code>@PostConstruct</code>和<code>@PreDestroy</code> 注释的方法</li>
<li><code>InitializingBean</code>和<code>DisposableBean</code>回调接口定义的方法</li>
<li>自定义配置<code>init()</code>和<code>destroy()</code>方法</li>
</ol>
<h4 id="bean生命周期调用顺序"><a href="#bean生命周期调用顺序" class="headerlink" title="bean生命周期调用顺序"></a>bean生命周期调用顺序</h4><ol>
<li><code>bean</code>实例化：容器寻找<code>bean</code>的定义信息并将其实例化</li>
<li>依赖注入：按照<code>BeanDefination</code>配置<code>bean</code>的属性</li>
<li><code>BeanNameAware</code>：如果实现该接口，调用<code>setBeanName()</code>方法</li>
<li><code>BeanFactoryAware</code>：如果实现该接口，调用<code>setBeanFactory()</code>方法</li>
<li><code>BeanPostProcessors</code>：如果实现该接口，调用<code>ProcessBeforeInitialization()</code>方法</li>
<li><code>initializingBean</code>：如果实现该接口，调用<code>afterPropertiesSet()</code>方法</li>
<li><code>init-method</code>：如果有该配置，调用<code>init-method</code>指定的方法</li>
<li><code>BeanPostProcessors</code>：如果实现该接口，调用<code>ProcessaAfterInitialization()</code>方法</li>
<li>bean配置完成，可以在业务代码中使用</li>
<li><code>DisposableBean</code>：如果实现该接口，调用<code>destroy()</code>方法</li>
<li><code>destroy-method</code>：如果有该配置，调用<code>destroy-method</code>指定的方法</li>
</ol>
<h4 id="容器级生命周期回调"><a href="#容器级生命周期回调" class="headerlink" title="容器级生命周期回调"></a>容器级生命周期回调</h4><h5 id="Lifecycle-接口"><a href="#Lifecycle-接口" class="headerlink" title="Lifecycle 接口"></a>Lifecycle 接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line">    <span class="comment">//容器启动回调</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//容器关闭回调</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isRunning</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>任何<code>spring</code>所管理的对象都可以实现该接口，当<code>ApplicationContext</code>接收到启动和停止信号时，就会级联调用当前上下文中<code>Lifecycle</code>的所有实现。</p>
<h5 id="LifecycleProcessor-接口"><a href="#LifecycleProcessor-接口" class="headerlink" title="LifecycleProcessor 接口"></a>LifecycleProcessor 接口</h5><p><code>LifecycleProcessor</code>是<code>Lifecycle</code>的扩展接口，它添加了刷新和关闭上下文的回调方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LifecycleProcessor</span> <span class="keyword">extends</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line">    <span class="comment">//刷新上下文回调</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭上下文回调</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SmartLifecycle-接口"><a href="#SmartLifecycle-接口" class="headerlink" title="SmartLifecycle 接口"></a>SmartLifecycle 接口</h5><p>不同bean启动和关闭的顺序可能比较重要，比如A依赖B，那么在启动时B应该在A之前启动，在关闭时A应该在B之前关闭，所以他们两个顺序时固定的，可以使用<code>Phased</code>接口，它提供了<code>getPhase()</code>方法，该方法会返回一个<code>int</code>值，表示执行顺序，启动时最小的<code>phase</code>最先启动，停止时相反。比如上面的例子就可以设置A为200，B为100</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Phased</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回值表示启动顺序</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPhase</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要对特定 <code>bean</code> 的自动启动（包括启动阶段）进行细粒度控制需要使用<code>SmartLifecycle</code>接口，它实现了Phased接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmartLifecycle</span> <span class="keyword">extends</span> <span class="title class_">Lifecycle</span>, Phased &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">DEFAULT_PHASE</span> <span class="operator">=</span> <span class="number">2147483647</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//刷新回调会调用该方法，判断是否在该点启动，</span></span><br><span class="line">    <span class="comment">//返回true时，Spring容器启动时会去执行start()方法。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isAutoStartup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DefaultLifecycleProcessor会调用该方法</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">(Runnable callback)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stop();</span><br><span class="line">        <span class="comment">//调用回调的run()方法</span></span><br><span class="line">        <span class="comment">//相当于开启异步关闭功能</span></span><br><span class="line">        callback.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回的是优先级</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">int</span> <span class="title function_">getPhase</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2147483647</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上面代码所示，<code>SmartLifecycle</code>接口的<code>getPhase()</code>方法返回的如果返回的是<code>2147483647</code>，如果没有实现<code>SmartLifecycle</code>接口的<code>Lifecycle</code>对象默认为0，因此负的<code>phase</code>会在常规<code>Lifecycle</code>之前启动，之后停止。</p>
<p><code>LifecycleProcessor</code>接口的默认实现是<code>DefaultLifecycleProcessor</code>，负责在每个阶段中调用对象组的<code>stop()</code>方法，直到超时为止，默认是30秒，可以在上下文中定义<code>bean</code>的<code>timeoutPerShutdownPhase</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lifecycleProcessor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.DefaultLifecycleProcessor&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeout value in milliseconds --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeoutPerShutdownPhase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="实际使用"><a href="#实际使用" class="headerlink" title="实际使用"></a>实际使用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringLifeCycle</span> <span class="keyword">implements</span> <span class="title class_">SmartLifecycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动信号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isRunning;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Lifecycle方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start-&gt;容器启动回调&quot;</span>);</span><br><span class="line">        <span class="comment">//正在运行</span></span><br><span class="line">        isRunning = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;stop-&gt;容器关闭回调&quot;</span>);</span><br><span class="line">        <span class="comment">//标记停止</span></span><br><span class="line">        isRunning = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//容器是否正在运行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isRunning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;isRunning&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> isRunning;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//SmartLifecycle方法</span></span><br><span class="line">    <span class="comment">//容器启动时是否去执行start()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAutoStartup</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;isAutoStartup&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">(Runnable callback)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;stop-&gt;生命周期结束&quot;</span>);</span><br><span class="line">        isRunning = <span class="literal">false</span>;</span><br><span class="line">        callback.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//优先级</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPhase</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getPhase-&gt;获取优先级&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Aware"><a href="#Aware" class="headerlink" title="Aware"></a>Aware</h3><p><code>spring</code>提供了很多的<code>Aware</code>接口，他们的目的是让<code>bean</code>可以获取<code>Spring</code>容器的服务。其实就是一堆用来做依赖注入的回调方法，通过这些方法可以在某些阶段向<code>bean</code>注入一些东西。但这种方式不太好，因为<code>bean</code>代码与<code>spring</code>存在耦合，相比之下用注解进行依赖注入更好</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>注入依赖</th>
</tr>
</thead>
<tbody><tr>
<td>ApplicationContextAware</td>
<td>应用上下文对象</td>
</tr>
<tr>
<td>ApplicationEventPublisherAware</td>
<td></td>
</tr>
<tr>
<td>BeanClassLoaderAware</td>
<td></td>
</tr>
<tr>
<td>BeanFactoryAware</td>
<td></td>
</tr>
<tr>
<td>BeanNameAware</td>
<td><code>bean</code>的名字</td>
</tr>
<tr>
<td>LoadTimeWeaverAware</td>
<td></td>
</tr>
<tr>
<td>MessageSourceAware</td>
<td></td>
</tr>
<tr>
<td>NotificationPublisherAware</td>
<td></td>
</tr>
<tr>
<td>ResourceLoaderAware</td>
<td></td>
</tr>
<tr>
<td>ServletConfigAware</td>
<td></td>
</tr>
<tr>
<td>ServletContextAware</td>
<td></td>
</tr>
</tbody></table>
<h4 id="ApplicationContextAware"><a href="#ApplicationContextAware" class="headerlink" title="ApplicationContextAware"></a>ApplicationContextAware</h4><p>如果需要将<code>ApplicationContext</code>注入到<code>bean</code>中，可以创建一个<code>bean</code>并实现<code>ApplicationContextAware</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplicationContextAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ApplicationContextAware</code>接口中包含<code>setApplicationContext</code>方法，通过实现这个方法完成对<code>applicationContext</code>的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAware</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ApplicationEventPublisherAware"><a href="#ApplicationEventPublisherAware" class="headerlink" title="ApplicationEventPublisherAware"></a>ApplicationEventPublisherAware</h4><p>如果需要将配置的<code>beanName</code>注入到<code>bean</code>中，可以创建一个<code>bean</code>并实现<code>BeanNameAware</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanNameAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String var1)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过实现该接口的<code>setBeanName</code>方法完成对<code>beanName</code>的设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAware</span> <span class="keyword">implements</span> <span class="title class_">BeanNameAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.beanName = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="其他Aware接口"><a href="#其他Aware接口" class="headerlink" title="其他Aware接口"></a>其他Aware接口</h4><p>每个Aware接口的使用方式其实没有区别，关键在于理解每个Aware接口注入实例的作用。关于其他的Aware接口的使用方式不再列出，参照上面两个例子写即可。</p>
<h3 id="其他扩展点"><a href="#其他扩展点" class="headerlink" title="其他扩展点"></a>其他扩展点</h3><h4 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h4><p><code>Spring</code>框架提供了<code>BeanPostProcessor</code>接口，通过实现该接口并重写之内的方法来定义回调逻辑，<code>Spring</code>会负责自动检测并调用适当的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以配置多个<code>BeanPostProcessor</code>实例，并且<code>BeanPostProcessor</code>可以通过实现<code>Ordered</code>接口设置<code>order</code>来控制这些实例的运行顺序。</p>
<p>当在配置类中使用<code>@bean</code>注解一个定义<code>BeanPostProcessor</code>的工厂方法时，工厂方法的返回值应该是实现或者至少是<code>BeanPostProcessor</code>接口，明确指定<code>post-processor</code>。否则<code>ApplicationContext</code>无法自动检测到。</p>
<h4 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h4><p>此接口用于对bean配置元数据进行操作，可以通过这个接口读取配置元数据并在容器实例化bean之前更改配置元，和<code>BeanPostProcessor</code>类似，但<code>BeanPostProcessor</code>接口时是用来更改<code>bean</code>实例的。该接口也需要与<code>Ordered</code>解耦一起使用指定顺序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory var1)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h4><p><code>FactoryBean</code>接口用于<code>ioc</code>容器的实例化逻辑，如果有复杂的初始化逻辑，可以通过java代码的方式替换冗长的<code>xml</code>。FactoryBean接口提供了三种方法：</p>
<ul>
<li><code>T getObject()</code>：返回此工厂创建的对象的实例。实例可能会被共享，这取决于这个工厂是返回单例还是原型；</li>
<li><code>boolean isSingleton()</code>:<code>true</code>代表<code>FactoryBean</code>返回单例，<code>false</code>表示其他情况 。此方法的默认实现返回<code>true</code>；</li>
<li><code>Class&lt;?&gt; getObjectType()</code>: 返回<code>getObject()</code>方法返回的对象类型，如果不知道类型就返回<code>null</code>；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> <span class="string">&quot;factoryBeanObjectType&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;MyBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> MyBean.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="基于java和注解的容器配置"><a href="#基于java和注解的容器配置" class="headerlink" title="基于java和注解的容器配置"></a>基于java和注解的容器配置</h2><p>注解注入在<code>XML</code>注入之前执行，所以，如果两种方式同时使用，<code>XML</code>可能会覆盖注释的某些配置。</p>
<h3 id="组件扫描与组件"><a href="#组件扫描与组件" class="headerlink" title="组件扫描与组件"></a>组件扫描与组件</h3><h4 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h4><h5 id="ComponentScan和-ComponentScans"><a href="#ComponentScan和-ComponentScans" class="headerlink" title="@ComponentScan和@ComponentScans"></a>@ComponentScan和@ComponentScans</h5><p><code>@ComponentScan</code>注解和<code>@ComponentScans</code>注解用于扫描<code>spring</code>组件。一般声明在配置类上，主要扫描<code>@Component</code>注解和包含<code>@Component</code>的组合注解。</p>
<p><code>@ComponentScan</code>注解内声明扫描组件所在的包，比较重要的属性如下：</p>
<ul>
<li><code>value</code>&#x2F;<code>basePackages</code>：扫描的包，默认是该配置类所在的包。</li>
<li><code>excludeFilters</code>：排除要扫描的项，<a href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E8%BF%87%E6%BB%A4">查看详情</a></li>
<li><code>includeFilters</code>：指定要扫描的包，<a href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E8%BF%87%E6%BB%A4">查看详情</a></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@ComponentScans</code>注解内部是一个<code>@ComponentScan</code>注解的数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScans(&#123;@ComponentScan(value = &quot;test&quot;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要<strong>使用<code>xml</code>的方式扫描</strong>可以如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="组件扫描过滤"><a href="#组件扫描过滤" class="headerlink" title="组件扫描过滤"></a>组件扫描过滤</h5><p>可以通过指定<code>@ComponentScan</code>的<code>excludeFilters</code>和<code>includeFilters</code>属性自定义过滤器，每个过滤器都需要<code>type</code>和<code>expression</code>属性</p>
<table>
<thead>
<tr>
<th>过滤器类型</th>
<th>示例表达式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>annotation（默认）</td>
<td>org.example.SomeAnnotation</td>
<td>在目标组件的类级别存在该注释或其组合注释</td>
</tr>
<tr>
<td>assignable</td>
<td>org.example.SomeClass</td>
<td>目标组件继承或实现了该类</td>
</tr>
<tr>
<td>aspectj</td>
<td><code>org.example..*Service+</code></td>
<td>与目标组件匹配的<code>aspectj</code>表达式</td>
</tr>
<tr>
<td>regex</td>
<td>org.example.Default.*</td>
<td>与目标组件匹配的正则表达式</td>
</tr>
<tr>
<td>custom</td>
<td>org.example.MyTypeFilter</td>
<td>根据接口的自定义实现</td>
</tr>
</tbody></table>
<p>也可以使用等效的<code>xml</code>标签：</p>
<ul>
<li><code>&lt;context:exclude-filter /&gt;</code></li>
<li><code>&lt;context:include-filter /&gt;</code></li>
</ul>
<p>下面例子表示扫描<code>test</code>包，然后排除符合<code>test.anno.*Value</code>的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &quot;test&quot;,</span></span><br><span class="line"><span class="meta">               excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">                   @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                       type = FilterType.REGEX,</span></span><br><span class="line"><span class="meta">                       pattern = &quot;test.anno.*Value&quot;)&#125;,</span></span><br><span class="line"><span class="meta">              )</span></span><br></pre></td></tr></table></figure>

<p>上面例子等效于<code>xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;regex&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">expression</span>=<span class="string">&quot;test.anno.*Value&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>spring</code>默认会自动检测使用<code>@Component</code>、<code>@Repository</code>、<code>@Service</code>、<code>@Controller</code>、<code>@RestController</code>或<code>@Configuration</code>进行注释或元注释的类。如果希望ji<strong>禁用这个默认行为</strong>可以设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &quot;xxx&quot;,</span></span><br><span class="line"><span class="meta">               useDefaultFilters = false</span></span><br><span class="line"><span class="meta">              )</span></span><br></pre></td></tr></table></figure>

<p>等效的<code>xml</code>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;xxx&quot;</span> </span></span><br><span class="line"><span class="tag">                        <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="Component-及其组合注解"><a href="#Component-及其组合注解" class="headerlink" title="@Component 及其组合注解"></a>@Component 及其组合注解</h4><p><code>@Component</code>注解用来标记<code>spring</code>的一个组件，是一个通用注解，使用<code>@Component</code>注解提供给各个层的注解有：</p>
<ul>
<li><code>@Repository</code>：持久层</li>
<li><code>@Service</code>：服务层</li>
<li><code>@Controller</code>：表示层</li>
<li><code>@Configuration</code>：配置类</li>
</ul>
<p>他们用来标记应该注册进容器的<code>bean</code>类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;dog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些组件注解如果没指明<code>value</code>，他的<code>bean</code>名称会由<code>BeanNameGenerator</code>生成。默认情况下是首字母小写的名称，比如上面例子如果不指定名称则为<code>dog</code>。</p>
<p>如果不想使用默认的名称生成策略，可以实现 <code>BeanNameGenerator</code> 接口，并确保包含一个默认的无参数构造函数。然后，在配置扫描器时提供完全限定的类名，如下配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;, nameGenerator = MyNameGenerator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyNameGenerator</span> <span class="keyword">implements</span> <span class="title class_">BeanNameGenerator</span> &#123;</span><br><span class="line">    <span class="comment">//在该方法中指定命名策略即可</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateBeanName</span><span class="params">(BeanDefinition beanDefinition, </span></span><br><span class="line"><span class="params">                                   BeanDefinitionRegistry beanDefinitionRegistry)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Bean-注解"><a href="#Bean-注解" class="headerlink" title="@Bean 注解"></a>@Bean 注解</h4><p>可以在组件中使用<code>@bean</code>注解向容器中注入<code>bean</code>，也可以在该<code>bean</code>工厂方法上添加其他<code>spring</code>注解设置该<code>beanDefinition</code>，一般声明在<code>@Configuration</code>修饰的类上，这时是完整模式。声明在其他类上时被称为精简模式，精简模式不能声明依赖，也就是说这个<code>bean</code>工厂方法的参数不能引入其他<code>bean</code>依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定bean的name，默认是方法名，多个名字可使用一个数组传递</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;cat&quot;)</span></span><br><span class="line">    <span class="comment">//可以声明为static</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> Animal <span class="title function_">getCat</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//限定修饰符?</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;public&quot;)</span></span><br><span class="line">    <span class="comment">//作用域</span></span><br><span class="line">    <span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line">    <span class="comment">//懒加载</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="meta">@Description(&quot;bean的描述信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Animal <span class="title function_">getDog</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法中可以定义参数，会自动进行<strong>依赖注入</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">default</span> TransferServiceImpl <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以同时定义bean的各种<strong>声明周期</strong>配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;init&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BeanOne <span class="title function_">beanOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanOne</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(destroyMethod = &quot;cleanup&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BeanTwo <span class="title function_">beanTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanTwo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Scope-注解"><a href="#Scope-注解" class="headerlink" title="@Scope 注解"></a>@Scope 注解</h4><h5 id="Scope-使用"><a href="#Scope-使用" class="headerlink" title="@Scope 使用"></a>@Scope 使用</h5><p><code>@Scope</code> 注解用于指定<code>bean</code>的<code>scope</code>，如果想要使用自定义策略可以实现<code>ScopeMetadataResolver</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanScope</span> <span class="keyword">implements</span> <span class="title class_">ScopeMetadataResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ScopeMetadata <span class="title function_">resolveScopeMetadata</span><span class="params">(BeanDefinition definition)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在类扫描器中指定它</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.example&quot;, scopeResolver = MyScopeResolver.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>xml</code>形式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example&quot;</span> </span></span><br><span class="line"><span class="tag">                            <span class="attr">scope-resolver</span>=<span class="string">&quot;org.example.MyScopeResolver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="scoped-proxy"><a href="#scoped-proxy" class="headerlink" title="scoped-proxy"></a>scoped-proxy</h5><p><code>spring</code>提供了一种通过作用域代理来处理依赖的方式。使用 XML 配置时创建此类代理的最简单方法是<code>&lt;aop:scoped-proxy/&gt;</code>元素。使用注释在 Java 中配置 bean提供了对属性<code>@Scope</code>的等效支持。<code>proxyMode</code>默认值为<code>ScopedProxyMode.DEFAULT</code>，这通常表示不应创建作用域代理，除非在组件扫描指令级别配置了不同的默认值。您可以 指定<code>ScopedProxyMode.TARGET_CLASS</code>、<code>ScopedProxyMode.INTERFACES</code>或<code>ScopedProxyMode.NO</code></p>
<h4 id="Configuration-注解"><a href="#Configuration-注解" class="headerlink" title="@Configuration 注解"></a>@Configuration 注解</h4><h5 id="Configuration-使用"><a href="#Configuration-使用" class="headerlink" title="@Configuration 使用"></a>@Configuration 使用</h5><p><code>@Configuration</code>是一个类级别的注解，用来表示一个配置类，内部可声明多个<code>@bean</code>，本身是用来替代<code>xml</code>的，也可以和<code>xml</code>配合使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">getCat</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;dog&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="查找方法注入-1"><a href="#查找方法注入-1" class="headerlink" title="查找方法注入"></a>查找方法注入</h5><p>在单例范围的 bean 依赖于原型范围的 bean 的情况下，会用到查找方法注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommandManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(Object commandState)</span> &#123;</span><br><span class="line">        <span class="comment">// grab a new instance of the appropriate Command interface</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> createCommand();</span><br><span class="line">        <span class="comment">// set the state on the (hopefully brand new) Command instance</span></span><br><span class="line">        command.setState(commandState);</span><br><span class="line">        <span class="keyword">return</span> command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// okay... but where is the implementation of this method?</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Command <span class="title function_">createCommand</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AsyncCommand <span class="title function_">asyncCommand</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AsyncCommand</span> <span class="variable">command</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsyncCommand</span>();</span><br><span class="line">    <span class="comment">// inject dependencies here as required</span></span><br><span class="line">    <span class="keyword">return</span> command;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CommandManager <span class="title function_">commandManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// return new anonymous implementation of CommandManager with createCommand()</span></span><br><span class="line">    <span class="comment">// overridden to return a new prototype Command object</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommandManager</span>() &#123;</span><br><span class="line">        <span class="keyword">protected</span> Command <span class="title function_">createCommand</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> asyncCommand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="import-注解"><a href="#import-注解" class="headerlink" title="@import 注解"></a>@import 注解</h4><p><code>@import</code>注解用来引入另一个配置类并进行加载，这个注解也是<code>spring boot</code>的核心</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigA</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> A <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(ConfigA.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigB</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Conditional-注解"><a href="#Conditional-注解" class="headerlink" title="@Conditional 注解"></a>@Conditional 注解</h4><p><code>@Conditional</code>一般用于配置类中，与<code>@bean</code>一起使用。表示必须满足某些条件才能实例化<code>bean</code>。它内部引入了一个实现了<code>Condition</code>接口的类，并且重写了<code>matches</code>方法，在改方法中会条件判断是否成立，如果成立返回<code>true</code>，否则返回<code>false</code>，下面举例说明</p>
<h5 id="Profile-注解"><a href="#Profile-注解" class="headerlink" title="@Profile 注解"></a>@Profile 注解</h5><p>此处只是为了解释<code>@Conditional</code>，<code>@Profile</code>的使用会在后文详细介绍。</p>
<p><code>@Profile</code> 注解内部就是条件注解实现的，判断依据是当前项目的环境</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span><span class="comment">//测试环境才加载</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span><span class="comment">//开发环境标识</span></span><br></pre></td></tr></table></figure>

<p>他一般作用在<code>@bean</code>方法上和配置类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional(&#123;ProfileCondition.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Profile &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他引入了一个<code>ProfileCondition</code>类，其内部的<code>matches</code>方法定义了判断条件的逻辑，参数有条件上下文和注解的元数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProfileCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    ProfileCondition() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        MultiValueMap&lt;String, Object&gt; attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());</span><br><span class="line">        <span class="keyword">if</span> (attrs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> ((List)attrs.get(<span class="string">&quot;value&quot;</span>)).iterator();</span><br><span class="line"></span><br><span class="line">            Object value;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!var4.hasNext()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                value = var4.next();</span><br><span class="line">            &#125; <span class="keyword">while</span>(!context.getEnvironment().acceptsProfiles(Profiles.of((String[])((String[])value))));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ImportResource-注解"><a href="#ImportResource-注解" class="headerlink" title="@ImportResource 注解"></a>@ImportResource 注解</h4><p><code>@ImportResource</code> 注解用于导入外部的<code>xml</code>文件，一般声明在<code>@Configuration</code>类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:/com/acme/properties-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DriverManagerDataSource</span>(url, username, password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="生成候选组件索引"><a href="#生成候选组件索引" class="headerlink" title="生成候选组件索引"></a>生成候选组件索引</h4><p>路径扫描速度很快，但仍可以通过在编译时创建静态候选列表来提高大型应用程序的启动性能。现有的扫描注解和配置必须不变，然后加入以下<code>jar</code>包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-indexer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果是<code>gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.6及以下版本</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly <span class="string">&quot;org.springframework:spring-context-indexer:6.0.0-SNAPSHOT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.6及以上版本</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    annotationProcessor <span class="string">&quot;org.springframework:spring-context-indexer:6.0.0-SNAPSHOT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>合格jar包会生成一个<code>META-INF/spring.components</code>的文件，挡在类路径找到该文件时，索引会自动启动</p>
<h3 id="依赖注入-1"><a href="#依赖注入-1" class="headerlink" title="依赖注入"></a>依赖注入</h3><h4 id="Autowired-注解"><a href="#Autowired-注解" class="headerlink" title="@Autowired 注解"></a>@Autowired 注解</h4><p><code>@Autowired</code> 注解只按照类型匹配，想要通过<code>bean</code>名字匹配需要结合<code>@Qualifier</code>使用</p>
<h5 id="应用于构造函数"><a href="#应用于构造函数" class="headerlink" title="应用于构造函数"></a>应用于构造函数</h5><p>只有一个构造函数时不需要 <code>@Autowired</code> 注解，属性会自动注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扫描到<code>Person</code>类时会自动调用构造函数，然后注入属性</p>
<p>如果有多个构造函数需要通过<code>@Autowired</code> 注解指定要解析的构造函数，若不指定默认调用无参构造，若无参构造也没有则报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(Cat cat, Dog dog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多个构造函数标记<code>@Autowired</code>必须都将<code>required</code>设置为<code>false</code>，<code>spring</code>会优先选取匹配参数最多的构造函数，如果一个都不满足，则使用默认构造函数。如果只有一个构造函数标记<code>@Autowired</code>则可以为<code>true</code>。</p>
<h5 id="应用于setter-方法"><a href="#应用于setter-方法" class="headerlink" title="应用于setter 方法"></a>应用于setter 方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="应用于任意名称和多个参数的方法"><a href="#应用于任意名称和多个参数的方法" class="headerlink" title="应用于任意名称和多个参数的方法"></a>应用于任意名称和多个参数的方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ohohohoh</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>spring</code>会自动调用该方法注入依赖</p>
<h5 id="应用于字段"><a href="#应用于字段" class="headerlink" title="应用于字段"></a>应用于字段</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class Person &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private Cat cat;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获取对应类型的所有bean"><a href="#获取对应类型的所有bean" class="headerlink" title="获取对应类型的所有bean"></a>获取对应类型的所有<code>bean</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Cat和Dog的bean会被注入到animals</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Animal[] animals;</span><br><span class="line">    <span class="comment">//不是必须要用数组，也可以是任何适用的集合类型</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Animal&gt; animals;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果希望列表中的<code>bean</code>按特定顺序注入可以在目标<code>bean</code>实现<code>Ordered</code>接口，或者使用<code>@Order</code>或<code>@Priority</code>注释，否则会按容器中相应<code>bean</code>加载顺序注入</p>
<p>Map会根据value的值进行匹配，只要类型相同就都注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//会将所有Animal类型的bean注入，key是bean的name</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Animal&gt; animals;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用集合类型接收时至少要匹配到一个元素，如果一个都没匹配到，自动装配会失败</p>
<p><strong>补充</strong>：</p>
<ul>
<li>可以使用泛型作为隐式的限定，同一个类型的<code>bean</code>，不同的泛型类型也会作为限定条件；</li>
</ul>
<h4 id="Primary-注解"><a href="#Primary-注解" class="headerlink" title="@Primary 注解"></a>@Primary 注解</h4><p>由于<code>@Autowired</code>注解是根据类型进行注入的，所以可能出现多个候选者，这时候就需要使用 <code>@primary</code> 注解指定应有限考虑特定的<code>bean</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Animal animal;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不加<code>@Primary</code>因为<code>cat</code>和<code>dog</code>都是<code>Animal</code>类型的<code>bean</code>，不知道该注入哪个于是就会报错。上面指定<code>dog</code>为<code>@primary</code>，最终注入的就是<code>dog</code>；</p>
<p>如果是通过<code>@bean</code>注解注册<code>bean</code>，也可以在<code>@bean</code>注解的方法上加<code>@primary</code>，效果是一样的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">firstMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">secondMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Qualifier-注解"><a href="#Qualifier-注解" class="headerlink" title="@Qualifier 注解"></a>@Qualifier 注解</h4><p>如果有多个<code>bean</code>候选项，可以通过<code>@Qualifier</code>注解指定<code>bean</code>的限定值，一般使用<code>beanName</code>作为限定值，用于过滤候选项。</p>
<h5 id="应用于构造函数上"><a href="#应用于构造函数上" class="headerlink" title="应用于构造函数上"></a>应用于构造函数上</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="meta">@Qualifier(&quot;cat&quot;)</span> Animal animal)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.animal = animal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="应用于-Autowired-注释的方法上"><a href="#应用于-Autowired-注释的方法上" class="headerlink" title="应用于 @Autowired 注释的方法上"></a>应用于 @Autowired 注释的方法上</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sss</span><span class="params">(<span class="meta">@Qualifier(&quot;cat&quot;)</span> Animal animal)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.animal = animal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="和-Autowired-一起使用"><a href="#和-Autowired-一起使用" class="headerlink" title="和 @Autowired 一起使用"></a>和 @Autowired 一起使用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;cat&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Animal animal;</span><br></pre></td></tr></table></figure>

<h5 id="Qualifier-对应的-xml-配置"><a href="#Qualifier-对应的-xml-配置" class="headerlink" title="@Qualifier 对应的 xml 配置"></a>@Qualifier 对应的 xml 配置</h5><p>todo</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">qualifier</span> <span class="attr">value</span>=<span class="string">&quot;xxx&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="自定义限定注解"><a href="#自定义限定注解" class="headerlink" title="自定义限定注解"></a>自定义限定注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyQualifier &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>补充</strong>：</p>
<ul>
<li>除了上面的例子外，<code>@Qualifier</code> 还可以用于过滤<code>bean</code>后注入到集合依赖中；</li>
<li>如果只想使用<code>name</code>主<code>bean</code>有先考虑使用<code>@Resource</code>；</li>
</ul>
<h4 id="Resource-注解"><a href="#Resource-注解" class="headerlink" title="@Resource 注解"></a>@Resource 注解</h4><p><code>@Resource</code>注解默认根据名称和类型注入<code>bean </code> </p>
<ul>
<li><code>name</code>：<code>bean</code>的名字，默认值下面例子中列出</li>
<li><code>type</code>：对于类型，默认值下面例子中列出</li>
</ul>
<h5 id="应用于字段上"><a href="#应用于字段上" class="headerlink" title="应用于字段上"></a>应用于字段上</h5><p>如果没有指定<code>name</code>默认是字段名称，如果没有指定<code>type</code>，默认类型就为字段的类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Animal animal;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="应用于方法上"><a href="#应用于方法上" class="headerlink" title="应用于方法上"></a>应用于方法上</h5><p>如果没有指定<code>name</code>会将注入的变量名作为名称，比如下面例子默认就是<code>cat</code>。方法名可以随意。如果没有指定<code>type</code>，默认是参数类型，下面例子默认就是<code>Animal</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name = &quot;cat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Animal cat)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cat = cat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p><code>Environment</code>接口是集成在<code>spring</code>上下文中的环境抽象，他存储了当前应用程序中的配置文件和属性。配置文件会根据当前的活跃状态向容器中注册<code>bean</code>，而属性包括JVM、操作系统环境变量、命令行参数，一般会在所有应用程序中发挥作用。</p>
<h4 id="PropertySource注解"><a href="#PropertySource注解" class="headerlink" title="@PropertySource注解"></a>@PropertySource注解</h4><p><code>@PropertySource</code>用于导入外部配置内容，导入的配置会存储在上下文中的<code>environment</code>对象中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:MyConfig.properties&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@PropertySource</code>内部可以存在<code>$&#123;…&#125;</code>占位符，此占位符会根据环境中的属性进行解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/$&#123;test.placeholder:default/path&#125;/MyConfig.properties&quot;)</span></span><br></pre></td></tr></table></figure>

<p>上面环境中如果有<code>test.placeholder</code>属性则被解析，否则会使用冒号后的默认配置<code>default/path</code>，如果未指定默认配置则会报错</p>
<p><strong>补充</strong>：</p>
<ul>
<li><code>Spring Boot</code> 默认配置一个<code>PropertySourcesPlaceholderConfigurer</code>的<code>bean</code>，该<code>bean</code> 将从<code>application.properties</code>和<code>application.yml</code>文件中获取属性。</li>
</ul>
<h4 id="PropertySource-接口"><a href="#PropertySource-接口" class="headerlink" title="PropertySource 接口"></a>PropertySource 接口</h4><p><code>Environment</code>对象内中存在<code>propertySources</code>属性，它内部包含一个<code>PropertySource</code>的<code>CopyOnWriteArrayList</code> 列表，上下文的环境信息以这种形式保存在这个列表中。<code>Spring</code>的<code>StandardEnvironment</code>配置了两个 PropertySource 对象，一个代表 JVM 系统属性集（<code>System.getProperties()</code>），一个代表系统环境变量集（<code>System.getenv()</code>）。想要获取配置可以使用以下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> ctx.getEnvironment();</span><br><span class="line"><span class="comment">//是否包含配置</span></span><br><span class="line">environment.containsProperty(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"><span class="comment">//获取配置信息</span></span><br><span class="line">environment.getProperty(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>搜索配置是分层的</strong>，会按照<code>propertySources</code>从头向后变量，默认顺序如下：</p>
<ol>
<li>ServletConfig 参数（如果适用——例如，在<code>DispatcherServlet</code>上下文的情况下）</li>
<li>ServletContext 参数（web.xml 上下文参数条目）</li>
<li>JNDI 环境变量（<code>java:comp/env/</code>条目）</li>
<li>JVM 系统属性（<code>-D</code>命令行参数）</li>
<li>JVM系统环境（操作系统环境变量）</li>
</ol>
<p>上面的是默认顺序，也可以自己选择添加的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MutablePropertySources</span> <span class="variable">sources</span> <span class="operator">=</span> ctx.getEnvironment().getPropertySources();</span><br><span class="line"><span class="comment">//设置为头部，最高优先级</span></span><br><span class="line">sources.addFirst(<span class="keyword">new</span> <span class="title class_">MyPropertySource</span>());</span><br></pre></td></tr></table></figure>



<h4 id="Value-注解"><a href="#Value-注解" class="headerlink" title="@Value 注解"></a>@Value 注解</h4><p><code>@Value</code>通常用于注入外部属性，如果值不带<code>$&#123;…&#125;</code>占位符则直接注入，如果值带<code>$&#123;…&#125;</code>占位符，请看下面的例子</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件名：MyConfig.properties</span></span><br><span class="line"><span class="attr">test.value</span>=<span class="string">aaa</span></span><br></pre></td></tr></table></figure>

<p>引入配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:MyConfig.properties&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="应用于字段上-1"><a href="#应用于字段上-1" class="headerlink" title="应用于字段上"></a>应用于字段上</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.value&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="应用于构造方法上"><a href="#应用于构造方法上" class="headerlink" title="应用于构造方法上"></a>应用于构造方法上</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestValue</span><span class="params">(<span class="meta">@Value(&quot;$&#123;test.value&#125;&quot;)</span> String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="默认属性值"><a href="#默认属性值" class="headerlink" title="默认属性值"></a>默认属性值</h5><p><code>spring</code> 提供了一个默认的宽松嵌入式值解析器。它将尝试解析属性值，如果无法解析占位符，会将<code>@Value</code>注解中的值注入属性，下面例子中因为根本没有<code>test.value1</code>这个配置，所以解析失败，默认将<code>$&#123;test.value1&#125;</code>字面量注入属性。属性只能是字符串类型，其他类型会报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;test.value1&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String value;</span><br></pre></td></tr></table></figure>

<p>如果要严格控制不存在的值，可以声明一个<code>PropertySourcesPlaceholderConfigurer</code>的<code>bean</code>，如果通配符解析错误会初始化失败</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title function_">propertyPlaceholderConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertySourcesPlaceholderConfigurer</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>spring</code>提供了内置转换器<strong>支持允许自动处理简单的类型转换</strong>，多个逗号分隔的值会自动转换为字符数组。举例如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注入值</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;test.value&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">float</span> value;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;test.value1&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String[] value;</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置</span></span><br><span class="line">test.value=<span class="number">1</span></span><br><span class="line">test.value1=one,two,three</span><br></pre></td></tr></table></figure>

<p>设置<strong>属性默认值</strong>可以使用如下配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果取值失败会使用默认值</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;xxx.xxx:默认值&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String[] value;</span><br></pre></td></tr></table></figure>

<h5 id="自定义类型转换"><a href="#自定义类型转换" class="headerlink" title="自定义类型转换"></a>自定义类型转换</h5><p><code>spring</code>使用<code>ConversionService</code>来处理<code>@Value</code>注解中将<code>String</code>类型转换为目标类型的过程，如果想要自定义这个转化过程可以提供自定义的<code>ConversionService</code>的<code>bean</code>实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConversionService <span class="title function_">conversionService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultFormattingConversionService</span> <span class="variable">conversionService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFormattingConversionService</span>();</span><br><span class="line">        conversionService.addConverter(<span class="keyword">new</span> <span class="title class_">MyCustomConverter</span>());</span><br><span class="line">        <span class="keyword">return</span> conversionService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>todo</strong></p>
<h5 id="Value-包含SpEL表达式"><a href="#Value-包含SpEL表达式" class="headerlink" title="@Value 包含SpEL表达式"></a>@Value 包含SpEL表达式</h5><p>当<code>@Value</code>包含<code>SpEL</code>表达式时，该值会在运行时动态计算</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>todo（看到SpEL时补充）</strong></p>
<h4 id="Profile-注解-1"><a href="#Profile-注解-1" class="headerlink" title="@Profile 注解"></a>@Profile 注解</h4><p><code>Environment</code>对象中粗壮乃<code>activeProfiles</code>的<code>set</code>集合，里面存放着当前的激活状态</p>
<h5 id="Profile-作用"><a href="#Profile-作用" class="headerlink" title="@Profile 作用"></a>@Profile 作用</h5><p><code>@Profile</code> 用于声明一个或多个配置文件处于活动状态，如果指定配置不处于活跃状态，那么标记该注解的类不被解析和注册。可以包含一个配置文件名称（production）或者配置文件表达式。还可以使用更复杂的逻辑表达式（production &amp; test），逗号分隔按或算：</p>
<ul>
<li><code>!</code>：配置文件的逻辑“非”；</li>
<li><code>&amp;</code>：配置文件的逻辑“与”；</li>
<li><code>|</code>：配置文件的逻辑“或”；</li>
</ul>
<p>如果一个<code>@Configuration</code>类标有<code>@Profile</code>，如果指定的配置文件不是活跃状态，呢么其内的方法和注释都将被跳过。如果通过<code>@Import</code>引入了一个标有<code>@Profile</code>注解的<code>@Component</code>或<code>@Configuration</code>类，如果指定的配置文件没有激活，那么不会注册该类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//这两个环境时生效</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;production&quot;,&quot;development&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//不同环境使用不同数据源配置</span></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;development&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">standaloneDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用不同配置的@Bean的方法名称应不同</span></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;production&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">jndiDataSource</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="激活配置文件"><a href="#激活配置文件" class="headerlink" title="激活配置文件"></a>激活配置文件</h5><p><strong>方式一</strong>：在启动类中通过代码配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">ctx.getEnvironment().setActiveProfiles(<span class="string">&quot;development&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong>：使用<code>spring.profiles.active</code>属性激活配置文件，可以在系统环境变量、<code>JVM</code>系统属性、servlet 上下文参数等方式配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dspring.profiles.active=&quot;profile1,profile2&quot;</span><br></pre></td></tr></table></figure>

<p><strong>方式三</strong>：通过<code>Environment</code>配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.getEnvironment().setActiveProfiles(<span class="string">&quot;profile1&quot;</span>, <span class="string">&quot;profile2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>如果没有配置激活文件，默认激活<code>default</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultDataConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="自定义读取配置文件"><a href="#自定义读取配置文件" class="headerlink" title="自定义读取配置文件"></a>自定义读取配置文件</h4><p>todo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title function_">propertyPlaceholderConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PropertySourcesPlaceholderConfigurer</span> <span class="variable">placeholderConfigurer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertySourcesPlaceholderConfigurer</span>();</span><br><span class="line">    <span class="comment">//设置前缀</span></span><br><span class="line">    placeholderConfigurer.setPlaceholderPrefix(<span class="string">&quot;pre.&quot;</span>);</span><br><span class="line">    <span class="comment">//设置后缀</span></span><br><span class="line">    placeholderConfigurer.setPlaceholderSuffix(<span class="string">&quot;.suf&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> placeholderConfigurer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">the.value1</span>=<span class="string">bbb</span></span><br><span class="line"><span class="attr">the.value2</span>=<span class="string">ccc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;pre.the.value1.suf-pre.the.value2.suf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String value;<span class="comment">//bbb-ccc</span></span><br></pre></td></tr></table></figure>



<h3 id="JSR-330-标准注释"><a href="#JSR-330-标准注释" class="headerlink" title="JSR 330 标准注释"></a>JSR 330 标准注释</h3><p><code>spring 3</code>开始<code>spring</code>提供了对<code>JSR 330</code> 标准注释的支持。这些注释的扫描方式与<code>spring</code>注解相同。如果想要使用，需要引入相关<code>jar</code>包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.inject<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.inject-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中注解对比如下表：</p>
<table>
<thead>
<tr>
<th>spring注解</th>
<th>JSR 330 注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Autowired</td>
<td>@Inject</td>
<td>@Inject没有required属性，可以使用Optional替代</td>
</tr>
<tr>
<td>@Component</td>
<td>@Named &#x2F; @ManagedBean</td>
<td>JSR-330 does not provide a composable model, only a way to identify named components.</td>
</tr>
<tr>
<td>@Scope(“singleton”)</td>
<td>@Singleton</td>
<td>默认也是单例</td>
</tr>
<tr>
<td>@Qualifier</td>
<td>@Qualifier &#x2F; @Named</td>
<td></td>
</tr>
<tr>
<td>ObjectFactory</td>
<td>Provider</td>
<td>Provider使用get方法</td>
</tr>
</tbody></table>
<p><strong>破东西，呸，不好用！</strong> </p>
<h3 id="注册-LoadTimeWeaver"><a href="#注册-LoadTimeWeaver" class="headerlink" title="注册 LoadTimeWeaver"></a>注册 LoadTimeWeaver</h3><p>当<code>spring</code>需要动态转换类时，会用到<code>LoadTimeWeaver</code>类。将其加载到<code>JVM</code>中，可以使用<code>@EnableLoadTimeWeaving</code>注解到配置类上，以此来引入该类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableLoadTimeWeaving</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的<code>xml</code>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:load-time-weaver</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一般这个类会在jpa转换时用到，此处不再赘述，详细查看<code>spring data jpa</code></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Spring 核心功能：控制反转（IOC）</p><p><a href="http://example.com/2020/02/05/框架/Java/Spring/Spring核心功能：控制反转（IOC）/">http://example.com/2020/02/05/框架/Java/Spring/Spring核心功能：控制反转（IOC）/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>路由器</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-02-05</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-06-27</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/">Spring核心功能</a></div></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/03/18/%E6%A1%86%E6%9E%B6/Java/Spring/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%EF%BC%88AOP%EF%BC%89/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Spring 核心功能：面向切面编程（AOP）</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/02/02/%E6%8A%80%E6%9C%AF%E6%A0%88/Python/%E5%9F%BA%E7%A1%80/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"><span class="level-item">异常处理</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="路由器"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">路由器</p><p class="is-size-6 is-block">笔记</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>M78</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">187</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">35</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">39</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zcy626727" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zcy626727"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C#</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Dart/"><span class="level-start"><span class="level-item">Dart</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Elasticsearch/"><span class="level-start"><span class="level-item">Elasticsearch</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Elixir/"><span class="level-start"><span class="level-item">Elixir</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Elixir/Phoenix/"><span class="level-start"><span class="level-item">Phoenix</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Go/"><span class="level-start"><span class="level-item">Go</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">47</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/Spring-Boot/"><span class="level-start"><span class="level-item">Spring Boot</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/Spring-MVC/"><span class="level-start"><span class="level-item">Spring MVC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Arch/"><span class="level-start"><span class="level-item">Arch</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Fedora/"><span class="level-start"><span class="level-item">Fedora</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Ubuntu/"><span class="level-start"><span class="level-item">Ubuntu</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/LiveKit/"><span class="level-start"><span class="level-item">LiveKit</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Minio/"><span class="level-start"><span class="level-item">Minio</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/MongoDB/"><span class="level-start"><span class="level-item">MongoDB</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Scrapy/"><span class="level-start"><span class="level-item">Scrapy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Quarkus/"><span class="level-start"><span class="level-item">Quarkus</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/RabbitMQ/"><span class="level-start"><span class="level-item">RabbitMQ</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/TypeScript/"><span class="level-start"><span class="level-item">TypeScript</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/"><span class="level-start"><span class="level-item">前端</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">深度学习</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Transformers/"><span class="level-start"><span class="level-item">Transformers</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/pytorch/"><span class="level-start"><span class="level-item">pytorch</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">算法</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="level-start"><span class="level-item">设计模式</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-13T16:00:00.000Z">2024-07-14</time></p><p class="title"><a href="/2024/07/14/%E5%B7%A5%E5%85%B7/Elasticsearch/Elasticsearch%20SQL/">Elasticsearch SQL</a></p><p class="categories"><a href="/categories/Elasticsearch/">Elasticsearch</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-13T16:00:00.000Z">2024-07-14</time></p><p class="title"><a href="/2024/07/14/%E5%B7%A5%E5%85%B7/Elasticsearch/Elasticsearch%20%E6%90%9C%E7%B4%A2/">Elasticsearch 搜索</a></p><p class="categories"><a href="/categories/Elasticsearch/">Elasticsearch</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-13T16:00:00.000Z">2024-07-14</time></p><p class="title"><a href="/2024/07/14/%E5%B7%A5%E5%85%B7/Elasticsearch/Elasticsearch%20EQL/">Elasticsearch EQL</a></p><p class="categories"><a href="/categories/Elasticsearch/">Elasticsearch</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-13T16:00:00.000Z">2024-07-14</time></p><p class="title"><a href="/2024/07/14/%E5%B7%A5%E5%85%B7/Elasticsearch/Elasticsearch%20%E6%96%87%E6%A1%A3/">Elasticsearch 文档</a></p><p class="categories"><a href="/categories/Elasticsearch/">Elasticsearch</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-13T16:00:00.000Z">2024-07-14</time></p><p class="title"><a href="/2024/07/14/%E5%B7%A5%E5%85%B7/Elasticsearch/Elasticsearch%20%E7%B4%A2%E5%BC%95/">Elasticsearch 索引</a></p><p class="categories"><a href="/categories/Elasticsearch/">Elasticsearch</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">十二月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Arch/"><span class="tag">Arch</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker-%E5%91%BD%E4%BB%A4/"><span class="tag">Docker 命令</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fedora/"><span class="tag">Fedora</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java8%E6%96%B0%E7%89%B9%E6%80%A7/"><span class="tag">Java8新特性</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E6%A0%87%E5%87%86%E5%BA%93/"><span class="tag">Java标准库</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E6%A1%86%E6%9E%B6/"><span class="tag">Java框架</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E8%AF%AD%E6%B3%95/"><span class="tag">Java语法</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kubernetes/"><span class="tag">Kubernetes</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LiveKit/"><span class="tag">LiveKit</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Minio/"><span class="tag">Minio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/S3/"><span class="tag">S3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBootWeb%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90/"><span class="tag">SpringBootWeb框架集成</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E6%88%90/"><span class="tag">SpringBoot数据库集成</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/"><span class="tag">SpringBoot核心功能</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"><span class="tag">SpringBoot源码解析</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"><span class="tag">Spring数据访问</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/"><span class="tag">Spring核心功能</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring%E6%B3%A8%E8%A7%A3/"><span class="tag">Spring注解</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebRTC/"><span class="tag">WebRTC</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fedora/"><span class="tag">fedora</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"><span class="tag">函数式编程</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><span class="tag">分布式文件系统</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/"><span class="tag">包管理器</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tag">大数据</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">工具</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A1%86%E6%9E%B6/"><span class="tag">框架</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B5%8B%E8%AF%95/"><span class="tag">测试</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="tag">消息中间件</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%88%AC%E8%99%AB/"><span class="tag">爬虫</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><span class="tag">环境配置</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"><span class="tag">编程语言</span><span class="tag">63</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%83%A8%E7%BD%B2/"><span class="tag">部署</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">非关系型数据库</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"><span class="tag">面向对象</span><span class="tag">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar.png" alt="路由器" height="28"></a><p class="is-size-7"><span>&copy; 2024 路由器</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>